# Makefile ä½¿ç”¨æŒ‡å—

æœ¬é¡¹ç›®æä¾›äº† Makefile æ¥ç®€åŒ–å¼€å‘æµç¨‹ï¼Œæ”¯æŒæ‰¹é‡å¯åŠ¨ã€åœæ­¢å’Œç®¡ç†æ‰€æœ‰å¾®å‰ç«¯åº”ç”¨ã€‚

## å¿«é€Ÿå¼€å§‹

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# é¦–æ¬¡ä½¿ç”¨ï¼šå®Œæ•´å®‰è£…å’Œå¯åŠ¨
make setup
make dev
```

## å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

| å‘½ä»¤ | è¯´æ˜ |
|-----|------|
| `make dev` | å‰å°å¯åŠ¨æ‰€æœ‰åº”ç”¨ï¼ˆå¯ä»¥çœ‹åˆ°å®æ—¶æ—¥å¿—ï¼‰ |
| `make dev-bg` | åå°å¯åŠ¨æ‰€æœ‰åº”ç”¨ï¼ˆæ—¥å¿—å†™å…¥ logs/all-apps.logï¼‰ |
| `make stop` | ä¼˜é›…åœæ­¢æ‰€æœ‰åº”ç”¨ |
| `make kill` | å¼ºåˆ¶æ€æ­»ç«¯å£ 3000-3006 ä¸Šçš„æ‰€æœ‰è¿›ç¨‹ |
| `make restart` | é‡å¯æ‰€æœ‰åº”ç”¨ï¼ˆå‰å°ï¼‰ |
| `make restart-bg` | é‡å¯æ‰€æœ‰åº”ç”¨ï¼ˆåå°ï¼‰ |
| `make status` | æŸ¥çœ‹æ‰€æœ‰åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ |
| `make logs` | å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆä»…åå°æ¨¡å¼ï¼‰ |

### å•ç‹¬å¯åŠ¨åº”ç”¨

| å‘½ä»¤ | åº”ç”¨ | ç«¯å£ |
|-----|-----|------|
| `make dev-main` | ä¸»åº”ç”¨ | 3000 |
| `make dev-dashboard` | ä»ªè¡¨ç›˜ | 3001 |
| `make dev-agent` | Agent ç®¡ç† | 3002 |
| `make dev-cluster` | é›†ç¾¤ç®¡ç† | 3003 |
| `make dev-monitor` | ç›‘æ§ç®¡ç† | 3004 |
| `make dev-system` | ç³»ç»Ÿç®¡ç† | 3005 |
| `make dev-image-build` | é•œåƒæ„å»º | 3006 |

### å¼€å‘ä»»åŠ¡

| å‘½ä»¤ | è¯´æ˜ |
|-----|------|
| `make install` | å®‰è£…æ‰€æœ‰åº”ç”¨çš„ä¾èµ– |
| `make build` | æ„å»ºæ‰€æœ‰åº”ç”¨ |
| `make lint` | è¿è¡Œæ‰€æœ‰åº”ç”¨çš„ä»£ç æ£€æŸ¥ |
| `make clean` | æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©å’Œä¾èµ– |
| `make clean-build` | ä»…æ¸…ç†æ„å»ºäº§ç‰©ï¼ˆä¿ç•™ node_modulesï¼‰ |

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ—¥å¸¸å¼€å‘ï¼ˆæ¨èå‰å°æ¨¡å¼ï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰åº”ç”¨ï¼Œå¯ä»¥çœ‹åˆ°å®æ—¶æ—¥å¿—
make dev

# åœæ­¢ï¼ˆCtrl+C æˆ–æ–°ç»ˆç«¯æ‰§è¡Œï¼‰
make stop
```

**ä¼˜ç‚¹**ï¼š
- å¯ä»¥å®æ—¶çœ‹åˆ°æ‰€æœ‰åº”ç”¨çš„æ—¥å¿—
- æ–¹ä¾¿è°ƒè¯•
- ä½¿ç”¨ Ctrl+C å³å¯åœæ­¢

### åœºæ™¯ 2ï¼šåå°è¿è¡Œ

```bash
# åå°å¯åŠ¨æ‰€æœ‰åº”ç”¨
make dev-bg

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
make status

# æŸ¥çœ‹æ—¥å¿—
make logs

# åœæ­¢æœåŠ¡
make stop
```

**ä¼˜ç‚¹**ï¼š
- é‡Šæ”¾ç»ˆç«¯ï¼Œå¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…
- æ—¥å¿—ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿å›æº¯
- é€‚åˆé•¿æ—¶é—´è¿è¡Œ

### åœºæ™¯ 3ï¼šåªå¼€å‘æŸä¸ªå­åº”ç”¨

```bash
# åªå¯åŠ¨ä¸»åº”ç”¨å’ŒæŸä¸ªå­åº”ç”¨
make dev-main        # ç»ˆç«¯1
make dev-dashboard   # ç»ˆç«¯2ï¼ˆæˆ–å…¶ä»–å­åº”ç”¨ï¼‰
```

### åœºæ™¯ 4ï¼šç«¯å£è¢«å ç”¨é—®é¢˜

```bash
# å¼ºåˆ¶æ¸…ç†æ‰€æœ‰ç«¯å£
make kill

# é‡æ–°å¯åŠ¨
make dev
```

### åœºæ™¯ 5ï¼šå®Œå…¨é‡æ–°å¼€å§‹

```bash
# æ¸…ç†æ‰€æœ‰å†…å®¹
make clean

# é‡æ–°å®‰è£…å’Œå¯åŠ¨
make setup
make dev
```

## å‘½ä»¤è¯¦è§£

### `make status`

æ£€æŸ¥æ‰€æœ‰åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ï¼Œè¾“å‡ºç¤ºä¾‹ï¼š

```
ğŸ“Š åº”ç”¨è¿è¡ŒçŠ¶æ€:

  âœ… ä¸»åº”ç”¨ (main-app) - è¿è¡Œä¸­ (PID: 12345, Port: 3000)
  âœ… ä»ªè¡¨ç›˜ (dashboard-app) - è¿è¡Œä¸­ (PID: 12346, Port: 3001)
  âŒ Agentç®¡ç† (agent-app) - æœªè¿è¡Œ (Port: 3002)
  ...
```

### `make kill`

å¼ºåˆ¶æ€æ­»ç«¯å£ 3000-3006 ä¸Šçš„æ‰€æœ‰è¿›ç¨‹ï¼Œé€‚ç”¨äºï¼š
- `make stop` æ— æ³•åœæ­¢æ—¶
- ç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨æ—¶
- è¿›ç¨‹å¡æ­»æ—¶

### `make logs`

æŸ¥çœ‹åå°è¿è¡Œçš„æ—¥å¿—ï¼ˆéœ€è¦ä½¿ç”¨ `make dev-bg` å¯åŠ¨ï¼‰ï¼š
- å®æ—¶è·Ÿè¸ªæ—¥å¿—æ–‡ä»¶
- æŒ‰ Ctrl+C é€€å‡ºæŸ¥çœ‹ï¼ˆä¸ä¼šåœæ­¢åº”ç”¨ï¼‰

## å¸¸è§é—®é¢˜

### Q1: `make dev-bg` åå¦‚ä½•åœæ­¢ï¼Ÿ

```bash
make stop
# æˆ–
make kill
```

### Q2: å¦‚ä½•æŸ¥çœ‹åå°è¿è¡Œçš„æ—¥å¿—ï¼Ÿ

```bash
# å®æ—¶æŸ¥çœ‹
make logs

# æˆ–ç›´æ¥æŸ¥çœ‹æ–‡ä»¶
tail -f logs/all-apps.log
```

### Q3: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

```bash
# å¼ºåˆ¶æ¸…ç†ç«¯å£
make kill

# æˆ–æ‰‹åŠ¨æ¸…ç†ç‰¹å®šç«¯å£
lsof -ti:3000 | xargs kill -9
```

### Q4: `make stop` ä¸èµ·ä½œç”¨ï¼Ÿ

å¯èƒ½ PID æ–‡ä»¶ä¸¢å¤±æˆ–è¿›ç¨‹å¼‚å¸¸ï¼Œä½¿ç”¨ `make kill` å¼ºåˆ¶åœæ­¢ã€‚

### Q5: æŸä¸ªåº”ç”¨å¯åŠ¨å¤±è´¥ï¼Ÿ

```bash
# æŸ¥çœ‹çŠ¶æ€
make status

# å•ç‹¬å¯åŠ¨å¤±è´¥çš„åº”ç”¨æŸ¥çœ‹è¯¦ç»†é”™è¯¯
make dev-dashboard  # æ›¿æ¢ä¸ºå¤±è´¥çš„åº”ç”¨
```

## ä¸ pnpm å‘½ä»¤å¯¹æ¯”

| Makefile | pnpm | è¯´æ˜ |
|----------|------|------|
| `make dev` | `pnpm dev` | å¯åŠ¨æ‰€æœ‰åº”ç”¨ï¼ˆå‰å°ï¼‰ |
| `make stop` | `Ctrl+C` | åœæ­¢åº”ç”¨ |
| `make install` | `pnpm run install:all` | å®‰è£…ä¾èµ– |
| `make build` | `pnpm build` | æ„å»ºæ‰€æœ‰åº”ç”¨ |
| `make status` | âŒ æ—  | Makefile ç‹¬æœ‰ |
| `make kill` | âŒ æ—  | Makefile ç‹¬æœ‰ |

**Makefile é¢å¤–åŠŸèƒ½**ï¼š
- âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥
- âœ… å¼ºåˆ¶åœæ­¢æœåŠ¡
- âœ… åå°è¿è¡Œç®¡ç†
- âœ… ç»Ÿä¸€çš„å‘½ä»¤æ¥å£

## æŠ€æœ¯è¯´æ˜

### åå°è¿è¡ŒåŸç†

- ä½¿ç”¨ `nohup` å‘½ä»¤åœ¨åå°è¿è¡Œ
- PID ä¿å­˜åœ¨ `.pids/all.pid` æ–‡ä»¶
- æ—¥å¿—è¾“å‡ºåˆ° `logs/all-apps.log`

### ç«¯å£æ£€æµ‹

- ä½¿ç”¨ `lsof` å‘½ä»¤æ£€æµ‹ç«¯å£å ç”¨
- macOS å’Œ Linux ç³»ç»ŸåŸç”Ÿæ”¯æŒ
- Windows ç³»ç»Ÿéœ€è¦ä½¿ç”¨ WSL æˆ– Git Bash

### ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ .pids/          # PID æ–‡ä»¶ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â””â”€â”€ all.pid     # æ‰€æœ‰åº”ç”¨çš„è¿›ç¨‹ID
â””â”€â”€ logs/           # æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â””â”€â”€ all-apps.log # åå°è¿è¡Œæ—¥å¿—
```

è¿™äº›ç›®å½•å·²æ·»åŠ åˆ° `.gitignore`ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚
