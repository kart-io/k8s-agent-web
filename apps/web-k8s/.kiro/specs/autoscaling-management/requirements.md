# 自动扩缩容管理 - 需求文档

## 简介

为 K8s 资源管理 Web 应用添加 HorizontalPodAutoscaler (HPA) 管理功能，包括扩缩容策略配置查看、扩缩容历史、指标监控和状态展示。

## 需求

### 需求 1: HPA 资源列表和详情

**用户故事:** 作为集群管理员，我希望能够查看和管理所有 HPA 资源，以便了解应用的自动扩缩容配置。

#### 验收标准

1. WHEN 用户访问 HPA 管理页面 THEN 系统 SHALL 显示所有 HPA 的列表，包括名称、命名空间、目标资源、当前副本数、期望副本数、最小副本数、最大副本数、目标指标、创建时间
2. WHEN 用户点击 HPA 详情 THEN 系统 SHALL 显示完整信息，包括基本信息、扩缩容策略、当前指标、条件信息、扩缩容历史、YAML 配置
3. WHEN 当前副本数等于期望副本数 THEN 系统 SHALL 显示稳定状态标识
4. WHEN 当前副本数不等于期望副本数 THEN 系统 SHALL 显示扩缩容中状态标识
5. WHEN 用户筛选 HPA THEN 系统 SHALL 支持按集群、命名空间、目标资源类型进行筛选

### 需求 2: 扩缩容策略配置展示

**用户故事:** 作为应用开发者，我希望能够清晰地查看 HPA 的扩缩容策略，以便验证配置是否符合预期。

#### 验收标准

1. WHEN 用户查看扩缩容策略 THEN 系统 SHALL 显示最小副本数、最大副本数、目标资源类型、目标资源名称
2. WHEN 用户查看扩缩容指标 THEN 系统 SHALL 显示指标类型（Resource、Pods、Object、External）、指标名称、目标值
3. WHEN 指标类型为 Resource THEN 系统 SHALL 显示资源名称（CPU/内存）、目标类型（Utilization/AverageValue）、目标值
4. WHEN 指标类型为 Pods THEN 系统 SHALL 显示指标名称、目标平均值
5. WHEN 显示多个指标 THEN 系统 SHALL 使用表格形式清晰展示每个指标的配置

### 需求 3: 当前指标监控

**用户故事:** 作为运维人员，我希望能够实时查看 HPA 的当前指标值，以便判断扩缩容是否正常工作。

#### 验收标准

1. WHEN 用户查看当前指标 THEN 系统 SHALL 显示每个指标的当前值和目标值
2. WHEN 当前值超过目标值 THEN 系统 SHALL 显示向上扩容的提示
3. WHEN 当前值低于目标值 THEN 系统 SHALL 显示向下缩容的提示
4. WHEN 显示资源利用率 THEN 系统 SHALL 使用百分比和进度条展示
5. WHEN 用户查看指标趋势 THEN 系统 SHALL 显示指标的历史变化（如果有数据）

### 需求 4: 扩缩容历史查看

**用户故事:** 作为运维人员，我希望能够查看 HPA 的扩缩容历史，以便分析扩缩容行为。

#### 验收标准

1. WHEN 用户查看扩缩容历史 THEN 系统 SHALL 显示扩缩容事件列表，包括时间、操作类型（扩容/缩容）、前副本数、后副本数、原因
2. WHEN 显示扩缩容事件 THEN 系统 SHALL 使用不同颜色区分扩容（绿色）和缩容（蓝色）
3. WHEN 用户查看扩缩容原因 THEN 系统 SHALL 显示触发扩缩容的指标和阈值
4. WHEN 用户查看历史趋势 THEN 系统 SHALL 使用时间线或图表展示副本数变化

### 需求 5: HPA 状态和条件

**用户故事:** 作为运维人员，我希望能够查看 HPA 的状态和条件，以便快速定位问题。

#### 验收标准

1. WHEN 用户查看 HPA 状态 THEN 系统 SHALL 显示当前副本数、期望副本数、上次扩缩容时间
2. WHEN 用户查看 HPA 条件 THEN 系统 SHALL 显示条件类型（AbleToScale、ScalingActive、ScalingLimited）、状态、原因、消息
3. WHEN HPA 无法扩缩容 THEN 系统 SHALL 显示错误状态和原因（如目标资源不存在、指标不可用）
4. WHEN HPA 达到副本数上限或下限 THEN 系统 SHALL 显示限制警告

### 需求 6: 删除和安全

**用户故事:** 作为集群管理员，我希望删除 HPA 时能收到明确的提示，以避免影响应用的可用性。

#### 验收标准

1. WHEN 用户删除 HPA THEN 系统 SHALL 显示警告，说明删除后应用将失去自动扩缩容能力
2. WHEN 用户删除 HPA THEN 系统 SHALL 显示当前副本数，提醒用户确保手动管理副本数

## 非功能性需求

### 性能要求

1. 资源列表加载时间不应超过 2 秒
2. 指标数据刷新间隔不低于 30 秒

### 兼容性要求

1. 支持 HPA API v2（autoscaling/v2）
2. 支持多种指标类型（Resource、Pods、Object、External）

### 可维护性要求

1. 遵循现有项目的代码规范和架构模式
2. 使用 TypeScript 进行类型定义

## 验收测试场景

### 场景 1: 查看 HPA 配置

1. 访问 HPA 列表页
2. 查看不同应用的 HPA 配置
3. 验证目标资源、副本数范围、指标显示正确

### 场景 2: 监控扩缩容状态

1. 查看 HPA 详情
2. 查看当前指标值和目标值
3. 验证扩缩容状态显示正确

### 场景 3: 查看扩缩容历史

1. 查看 HPA 扩缩容历史事件
2. 验证事件时间、类型、副本数变化显示正确
3. 查看扩缩容原因

## 未来扩展

1. 支持创建和编辑 HPA
2. 支持 VerticalPodAutoscaler (VPA) 管理
3. 支持扩缩容策略推荐
4. 支持扩缩容告警配置
5. 支持指标实时监控和图表展示
6. 支持扩缩容模拟和预测
