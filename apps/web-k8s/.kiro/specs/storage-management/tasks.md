# 存储管理 - 实施任务列表

## 阶段 1: 基础设施和类型定义

- [ ] 1. 定义存储资源类型
  - 在 `src/api/k8s/types.ts` 中添加 PersistentVolume 接口
  - 在 `src/api/k8s/types.ts` 中添加 PersistentVolumeClaim 接口
  - 在 `src/api/k8s/types.ts` 中添加 StorageClass 接口
  - 在 `src/api/k8s/types.ts` 中添加存储统计相关接口
  - 添加类型导出
  - _需求: 1.1, 2.1, 3.1_

- [ ] 2. 更新资源类型常量
  - 在 `src/types/k8s-resource-base.ts` 中添加存储资源类型常量
  - 更新 RESOURCE_TYPE_METADATA 映射，添加 PV、PVC、StorageClass 元数据
  - 设置正确的图标、分类和路径
  - _需求: 1.1, 2.1, 3.1_

## 阶段 2: Mock 数据生成

- [ ] 3. 实现 PersistentVolume Mock 数据
  - 在 `src/api/k8s/mock.ts` 中实现 `getMockPVList` 函数
  - 生成多样化的 PV 数据（不同状态、容量、存储类、访问模式）
  - 实现存储后端类型的多样性（NFS、hostPath、CSI）
  - 实现筛选逻辑（按存储类、状态）
  - 实现分页逻辑
  - _需求: 1.1, 1.2_

- [ ] 4. 实现 PersistentVolumeClaim Mock 数据
  - 在 `src/api/k8s/mock.ts` 中实现 `getMockPVCList` 函数
  - 生成与 PV 关联的 PVC 数据
  - 确保 PVC 和 PV 的绑定关系一致
  - 实现筛选和分页逻辑
  - _需求: 2.1, 2.2, 4.1_

- [ ] 5. 实现 StorageClass Mock 数据
  - 在 `src/api/k8s/mock.ts` 中实现 `getMockStorageClassList` 函数
  - 生成多种提供者的 StorageClass 数据
  - 实现默认存储类标识
  - 添加参数和挂载选项数据
  - _需求: 3.1, 3.2_

- [ ] 6. 实现存储统计 Mock 数据
  - 在 `src/api/k8s/mock.ts` 中实现 `getMockStorageStats` 函数
  - 实现 `getMockStorageStatsByClass` 函数
  - 实现 `getMockStorageStatsByNamespace` 函数
  - 确保统计数据与 PV/PVC 数据一致
  - _需求: 5.1, 5.2, 5.3_

- [ ] 7. 实现 Pod 使用 PVC 的关联数据
  - 在现有 Pod Mock 数据中添加 volume 和 volumeMounts 配置
  - 实现 `getPodsUsingPVC` 辅助函数，查找使用特定 PVC 的 Pod
  - _需求: 2.7, 4.2_

## 阶段 3: 资源配置工厂函数

- [ ] 8. 创建 PersistentVolume 资源配置
  - 在 `src/config/k8s-resources.ts` 中实现 `createPVConfig` 函数
  - 定义 PV 列表的列配置
  - 定义 PV 的操作配置（查看、删除）
  - 定义筛选器配置（集群、存储类、状态、访问模式）
  - 定义状态标签配置
  - _需求: 1.1, 1.3, 1.4, 1.5, 1.6_

- [ ] 9. 创建 PersistentVolumeClaim 资源配置
  - 在 `src/config/k8s-resources.ts` 中实现 `createPVCConfig` 函数
  - 定义 PVC 列表的列配置
  - 定义 PVC 的操作配置（查看、删除）
  - 定义筛选器配置（集群、命名空间、存储类、状态）
  - 定义状态标签配置
  - _需求: 2.1, 2.3, 2.4, 2.5, 2.6_

- [ ] 10. 创建 StorageClass 资源配置
  - 在 `src/config/k8s-resources.ts` 中实现 `createStorageClassConfig` 函数
  - 定义 StorageClass 列表的列配置
  - 定义操作配置（查看）
  - 定义筛选器配置（集群、提供者、回收策略）
  - 添加默认存储类的特殊显示逻辑
  - _需求: 3.1, 3.2, 3.3, 3.5_

## 阶段 4: PersistentVolume 页面实现

- [ ] 11. 创建 PV 列表页面
  - 创建 `src/views/k8s/storage/persistent-volumes/index.vue`
  - 使用 ResourceList 组件
  - 应用 PV 资源配置
  - 实现自定义插槽（访问模式、绑定的 PVC）
  - _需求: 1.1, 1.6_

- [ ] 12. 创建 PV 详情抽屉
  - [ ] 12.1 创建抽屉组件骨架
    - 创建 `src/views/k8s/storage/persistent-volumes/DetailDrawer.vue`
    - 设置抽屉基础结构和标签页
    - _需求: 1.2_
  - [ ] 12.2 实现基本信息标签页
    - 显示名称、UID、容量、存储类、访问模式、回收策略、卷模式、状态、创建时间
    - 使用 Ant Design Descriptions 组件
    - _需求: 1.2_
  - [ ] 12.3 实现规格配置标签页
    - 显示存储后端类型及其配置（NFS、hostPath、CSI 等）
    - 显示节点亲和性配置
    - 显示挂载选项
    - _需求: 1.2_
  - [ ] 12.4 实现绑定关系标签页
    - 显示绑定的 PVC 信息（名称、命名空间）
    - 显示使用该 PVC 的 Pod 列表
    - 添加跳转到 PVC 和 Pod 详情的链接
    - _需求: 1.2, 4.1, 4.2, 4.3_
  - [ ] 12.5 实现 YAML 配置标签页
    - 显示完整的 PV YAML 配置
    - 实现复制到剪贴板功能
    - 实现下载 YAML 文件功能
    - 复用 Deployment 详情抽屉的 YAML 格式化逻辑
    - _需求: 1.2_

- [ ] 13. 集成 PV 列表页和详情抽屉
  - 在列表页实现打开详情抽屉的逻辑
  - 处理抽屉关闭后的状态重置
  - _需求: 1.2_

## 阶段 5: PersistentVolumeClaim 页面实现

- [ ] 14. 创建 PVC 列表页面
  - 创建 `src/views/k8s/storage/persistent-volume-claims/index.vue`
  - 使用 ResourceList 组件
  - 应用 PVC 资源配置
  - 实现自定义插槽（状态、访问模式）
  - _需求: 2.1, 2.6_

- [ ] 15. 创建 PVC 详情抽屉
  - [ ] 15.1 创建抽屉组件骨架
    - 创建 `src/views/k8s/storage/persistent-volume-claims/DetailDrawer.vue`
    - 设置抽屉基础结构和标签页
    - _需求: 2.2_
  - [ ] 15.2 实现基本信息标签页
    - 显示名称、命名空间、UID、状态、请求容量、实际容量、存储类、访问模式、创建时间
    - _需求: 2.2_
  - [ ] 15.3 实现规格配置标签页
    - 显示卷模式、选择器、数据源
    - _需求: 2.2_
  - [ ] 15.4 实现使用情况标签页
    - 调用 `getPodsUsingPVC` 获取使用该 PVC 的 Pod 列表
    - 使用 Table 组件显示 Pod 列表
    - 添加跳转到 Pod 详情的链接
    - _需求: 2.2, 2.7, 4.2_
  - [ ] 15.5 实现绑定的 PV 标签页
    - 显示绑定的 PV 详细信息（名称、容量、访问模式、节点亲和性）
    - 添加跳转到 PV 详情的链接
    - 处理未绑定状态的显示
    - _需求: 2.2, 4.1, 4.3_
  - [ ] 15.6 实现条件标签页
    - 显示 PVC 状态条件列表
    - 使用 Table 组件展示条件类型、状态、原因、消息、时间
    - _需求: 2.2, 4.5_
  - [ ] 15.7 实现 YAML 配置标签页
    - 显示完整的 PVC YAML 配置
    - 实现复制和下载功能
    - _需求: 2.2_

- [ ] 16. 集成 PVC 列表页和详情抽屉
  - 实现打开详情抽屉的逻辑
  - 处理状态重置
  - _需求: 2.2_

## 阶段 6: StorageClass 页面实现

- [ ] 17. 创建 StorageClass 列表页面
  - 创建 `src/views/k8s/storage/storage-classes/index.vue`
  - 使用 ResourceList 组件
  - 应用 StorageClass 资源配置
  - 实现默认存储类的特殊显示（Tag 或 Badge）
  - 实现自定义插槽（参数数量、是否允许扩容）
  - _需求: 3.1, 3.2, 3.5_

- [ ] 18. 创建 StorageClass 详情抽屉
  - [ ] 18.1 创建抽屉组件骨架
    - 创建 `src/views/k8s/storage/storage-classes/DetailDrawer.vue`
    - 设置抽屉基础结构和标签页
    - _需求: 3.2_
  - [ ] 18.2 实现基本信息标签页
    - 显示名称、UID、提供者、回收策略、绑定模式、是否允许扩容、是否为默认、创建时间
    - _需求: 3.2_
  - [ ] 18.3 实现参数配置标签页
    - 显示参数键值对列表
    - 使用卡片或列表形式展示
    - _需求: 3.2_
  - [ ] 18.4 实现挂载选项标签页
    - 显示挂载选项列表
    - _需求: 3.2_
  - [ ] 18.5 实现拓扑限制标签页
    - 显示允许的拓扑配置
    - 处理无拓扑限制的情况
    - _需求: 3.2_
  - [ ] 18.6 实现使用统计标签页
    - 显示使用该存储类的 PV 数量、PVC 数量
    - 显示总容量统计
    - 添加查看资源列表的按钮
    - _需求: 3.4_
  - [ ] 18.7 实现资源列表标签页
    - 使用 Table 组件显示使用该存储类的 PV 列表
    - 使用 Table 组件显示使用该存储类的 PVC 列表
    - 添加跳转到资源详情的链接
    - _需求: 3.6_
  - [ ] 18.8 实现 YAML 配置标签页
    - 显示完整的 StorageClass YAML 配置
    - 实现复制和下载功能
    - _需求: 3.2_

- [ ] 19. 集成 StorageClass 列表页和详情抽屉
  - 实现打开详情抽屉的逻辑
  - 处理状态重置
  - _需求: 3.2_

## 阶段 7: 存储概览页面实现

- [ ] 20. 创建存储概览页面骨架
  - 创建 `src/views/k8s/storage/overview/index.vue`
  - 设置页面布局（Grid 或 Flex 布局）
  - _需求: 5.1_

- [ ] 21. 创建容量统计组件
  - [ ] 21.1 创建统计卡片组件
    - 创建 `src/views/k8s/storage/overview/components/CapacityStats.vue`
    - 实现总容量、已用容量、可用容量、使用率四个卡片
    - 使用 Ant Design Card 和 Statistic 组件
    - _需求: 5.1_
  - [ ] 21.2 实现 PV 和 PVC 统计卡片
    - 显示 PV 总数、已绑定数、可用数
    - 显示 PVC 总数
    - _需求: 5.1_
  - [ ] 21.3 实现使用率告警
    - 当使用率超过 80% 时显示警告样式
    - 当使用率超过 90% 时显示错误样式
    - 使用不同颜色和图标表示告警级别
    - _需求: 5.5, 5.6_

- [ ] 22. 创建存储图表组件
  - [ ] 22.1 创建图表组件骨架
    - 创建 `src/views/k8s/storage/overview/components/StorageChart.vue`
    - 选择图表库（如 ECharts）
    - _需求: 5.2, 5.3_
  - [ ] 22.2 实现按存储类分布图
    - 使用饼图显示各存储类的容量占比
    - 添加图例和数据标签
    - 支持点击跳转到对应 StorageClass 详情
    - _需求: 5.2_
  - [ ] 22.3 实现按命名空间使用图
    - 使用柱状图显示各命名空间的存储使用情况
    - 添加坐标轴标签和数据标签
    - 支持点击跳转到对应命名空间的 PVC 列表
    - _需求: 5.3_

- [ ] 23. 创建最近绑定列表组件
  - 创建 `src/views/k8s/storage/overview/components/RecentBindings.vue`
  - 使用 Table 组件显示最近绑定的 PV/PVC 列表
  - 显示 PV 名称、PVC 名称、命名空间、容量、绑定时间
  - 添加跳转到详情的链接
  - _需求: 4.1_

- [ ] 24. 集成概览页面组件
  - 在概览页面中组合所有子组件
  - 实现数据获取和传递
  - 实现刷新功能
  - _需求: 5.1_

## 阶段 8: 路由配置

- [ ] 25. 添加存储管理路由
  - 在 `src/router/routes/modules/k8s.ts` 中添加存储管理路由组
  - 配置存储概览路由
  - 配置 PV 管理路由
  - 配置 PVC 管理路由
  - 配置 StorageClass 管理路由
  - 设置正确的图标和标题
  - _需求: 1.1, 2.1, 3.1, 5.1_

- [ ] 26. 更新导航菜单
  - 确保存储管理菜单项在导航中显示
  - 设置菜单项的顺序和分组
  - _需求: 1.1, 2.1, 3.1, 5.1_

## 阶段 9: 删除操作和安全增强

- [ ] 27. 实现 PV 删除逻辑
  - 在 `createPVConfig` 的删除操作中添加二次确认
  - 检查 PV 是否已绑定，如果已绑定则禁止删除或警告
  - 显示回收策略对数据的影响
  - _需求: 1.8, 6.1, 6.2_

- [ ] 28. 实现 PVC 删除逻辑
  - 在 `createPVCConfig` 的删除操作中添加二次确认
  - 检查是否有 Pod 正在使用该 PVC
  - 如果有 Pod 使用，显示 Pod 列表并警告用户
  - _需求: 2.8, 6.1_

- [ ] 29. 隐藏敏感信息
  - 在 PV 详情中隐藏或脱敏敏感的存储后端凭证
  - 在 YAML 配置中对敏感字段进行标记或隐藏
  - _需求: 6.3_

## 阶段 10: 测试和优化

- [ ] 30. 编写单元测试
  - 为 Mock 数据生成函数编写测试
  - 为容量计算辅助函数编写测试
  - 为状态映射函数编写测试
  - _需求: 全部_

- [ ] 31. 编写组件测试
  - 测试列表组件的渲染
  - 测试详情抽屉的数据显示
  - 测试筛选器功能
  - 测试统计卡片的计算
  - _需求: 全部_

- [ ] 32. 性能优化
  - [ ] 32.1 实现虚拟滚动
    - 在 VxeGrid 中启用虚拟滚动
    - 测试大量数据的渲染性能
    - _需求: 性能要求_
  - [ ] 32.2 实现懒加载
    - 详情抽屉的标签页数据懒加载
    - 图表组件按需加载
    - _需求: 性能要求_
  - [ ] 32.3 优化计算性能
    - 使用 computed 缓存容量计算结果
    - 对搜索输入进行防抖处理
    - _需求: 性能要求_

- [ ] 33. UI/UX 优化
  - 确保所有页面使用一致的布局和样式
  - 确保响应式设计在不同分辨率下正常工作
  - 优化加载状态和空状态的显示
  - 优化错误提示的显示
  - _需求: 兼容性要求_

- [ ] 34. 可访问性增强
  - 为图表添加文本描述
  - 确保键盘导航支持
  - 测试屏幕阅读器兼容性
  - _需求: 可访问性_

## 阶段 11: 文档和最终检查

- [ ] 35. 编写代码注释
  - 为所有导出的函数和组件添加 JSDoc 注释
  - 为复杂的逻辑添加内联注释
  - 确保注释覆盖率不低于 20%
  - _需求: 可维护性要求_

- [ ] 36. 更新项目文档
  - 更新 README 文件（如有需要）
  - 记录新增的路由和功能
  - 记录 Mock 数据的使用方法
  - _需求: 可维护性要求_

- [ ] 37. 最终验收测试
  - 执行验收测试场景 1: PV 生命周期管理
  - 执行验收测试场景 2: PVC 绑定流程
  - 执行验收测试场景 3: 存储类配置查看
  - 执行验收测试场景 4: 容量监控
  - 确保所有需求的验收标准都已满足
  - _需求: 全部_

- [ ] 38. 代码审查和重构
  - 进行代码自审，检查代码质量
  - 确保遵循项目代码规范
  - 重构重复代码，提高复用率
  - _需求: 可维护性要求_

## 总结

总任务数: 38 个主任务，60+ 个子任务

预估工作量:
- 阶段 1-3 (基础设施): 1-2 天
- 阶段 4-6 (资源页面): 3-4 天
- 阶段 7 (概览页面): 1-2 天
- 阶段 8-9 (路由和安全): 0.5-1 天
- 阶段 10-11 (测试和优化): 2-3 天

总预估: 7.5-12 天
