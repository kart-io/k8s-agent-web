# Qiankun å¯åŠ¨æ—¶åºé—®é¢˜ä¿®å¤

## ğŸš¨ é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯
```
Uncaught Error: application 'system-app' died in status LOADING_SOURCE_CODE:
[qiankun]: Target container with #micro-app-container not existed while system-app loading!
```

### è§¦å‘åœºæ™¯
- ç‚¹å‡»å­èœå•ï¼ˆå¦‚"ç³»ç»Ÿç®¡ç†" â†’ "ç”¨æˆ·ç®¡ç†"ï¼‰
- ç›´æ¥è®¿é—®å­èœå•è·¯ç”±ï¼ˆå¦‚ `/system/users`ï¼‰
- åˆ·æ–°å­èœå•é¡µé¢

### è¡¨ç°
- dashboard-app æ­£å¸¸åŠ è½½ âœ…
- agent-app æ­£å¸¸åŠ è½½ âœ…
- cluster-app æ­£å¸¸åŠ è½½ âœ…
- monitor-app æ­£å¸¸åŠ è½½ âœ…
- **system-app åŠ è½½å¤±è´¥** âŒï¼ˆå°¤å…¶æ˜¯å­èœå•è·¯ç”±ï¼‰

## ğŸ” æ ¹æœ¬åŸå› 

### é—®é¢˜åˆ†æ

**åŸä»£ç **ï¼ˆ`main.js`ï¼‰ï¼š
```javascript
app.mount('#app')

// æ³¨å†Œå¹¶å¯åŠ¨å¾®å‰ç«¯
registerApps()
startQiankun()
```

**é—®é¢˜**ï¼š
1. ä¸»åº”ç”¨ mount åç«‹å³å¯åŠ¨ qiankun
2. æ­¤æ—¶ Vue Router å¯èƒ½è¿˜æ²¡å®Œå…¨å‡†å¤‡å¥½
3. å¦‚æœåˆå§‹è·¯ç”±æ˜¯ `/system/users`ï¼ˆå­èœå•è·¯ç”±ï¼‰ï¼š
   - qiankun ç«‹å³å°è¯•åŠ è½½ system-app
   - ä½† MainLayout å¯èƒ½è¿˜æ²¡æ¸²æŸ“å®Œæˆ
   - `#micro-app-container` å®¹å™¨ä¸å­˜åœ¨
   - qiankun æŠ¥é”™

### æ—¶åºé—®é¢˜

```
åŸæµç¨‹ï¼ˆæœ‰é—®é¢˜ï¼‰ï¼š
1. app.mount('#app')
2. registerApps()         â† qiankun æ³¨å†Œ
3. startQiankun()         â† qiankun å¯åŠ¨
4. Router åˆå§‹åŒ–
5. åŒ¹é…è·¯ç”±: /system/users
6. æ¸²æŸ“ MainLayout
7. qiankun å°è¯•åŠ è½½ system-app  â† å®¹å™¨å¯èƒ½è¿˜ä¸å­˜åœ¨
```

**ä¸ºä»€ä¹ˆå…¶ä»–å­åº”ç”¨æ­£å¸¸ï¼Ÿ**
- å› ä¸ºé€šå¸¸æ˜¯ä» `/` æˆ– `/login` è¿›å…¥
- å†ç‚¹å‡»ä¸€çº§èœå•ï¼ˆå¦‚ `/dashboard`ï¼‰
- è¿™æ—¶ MainLayout å·²ç»æ¸²æŸ“å®Œæˆ
- å®¹å™¨å·²å­˜åœ¨

**ä¸ºä»€ä¹ˆ system-app å®¹æ˜“å‡ºé”™ï¼Ÿ**
- system-app æœ‰å­èœå•
- ç”¨æˆ·å¯èƒ½ç›´æ¥è®¿é—® `/system/users`
- æˆ–è€…åˆ·æ–°é¡µé¢æ—¶åœ¨å­èœå•è·¯ç”±ä¸Š

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ä»£ç 

**ä¿®æ”¹å**ï¼ˆ`main.js`ï¼‰ï¼š
```javascript
app.mount('#app')

// ç­‰å¾…è·¯ç”±å‡†å¤‡å¥½åå†æ³¨å†Œå¹¶å¯åŠ¨å¾®å‰ç«¯
router.isReady().then(() => {
  registerApps()
  startQiankun()
})
```

### ä¿®å¤åŸç†

```
æ–°æµç¨‹ï¼ˆå·²ä¿®å¤ï¼‰ï¼š
1. app.mount('#app')
2. Router åˆå§‹åŒ–
3. åŒ¹é…è·¯ç”±: /system/users
4. æ¸²æŸ“ MainLayout
5. å®¹å™¨åˆ›å»º: #micro-app-container
6. router.isReady() å®Œæˆ     â† ç­‰å¾…è·¯ç”±å‡†å¤‡å¥½
7. registerApps()             â† æ­¤æ—¶æ‰æ³¨å†Œ
8. startQiankun()             â† æ­¤æ—¶æ‰å¯åŠ¨
9. qiankun åŠ è½½ system-app    â† å®¹å™¨å·²å­˜åœ¨ âœ…
```

**å…³é”®æ”¹å˜**ï¼š
- ä½¿ç”¨ `router.isReady()` ç­‰å¾…è·¯ç”±ç³»ç»Ÿå‡†å¤‡å®Œæˆ
- ç¡®ä¿ MainLayout å·²æ¸²æŸ“
- ç¡®ä¿ `#micro-app-container` å·²å­˜åœ¨
- ç„¶åæ‰å¯åŠ¨ qiankun

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯ 1: ç›´æ¥è®¿é—®å­èœå•è·¯ç”±

```bash
# åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥
http://localhost:3000/system/users

é¢„æœŸ:
âœ… MainLayout æ¸²æŸ“
âœ… "ç³»ç»Ÿç®¡ç†"èœå•è‡ªåŠ¨å±•å¼€
âœ… "ç”¨æˆ·ç®¡ç†"èœå•é«˜äº®
âœ… system-app æ­£å¸¸åŠ è½½
```

### æµ‹è¯•åœºæ™¯ 2: åˆ·æ–°å­èœå•é¡µé¢

```bash
# 1. ç™»å½•ç³»ç»Ÿ
# 2. ç‚¹å‡» "ç³»ç»Ÿç®¡ç†" â†’ "ç”¨æˆ·ç®¡ç†"
# 3. æŒ‰ F5 åˆ·æ–°é¡µé¢

é¢„æœŸ:
âœ… é¡µé¢æ­£å¸¸åˆ·æ–°
âœ… system-app æ­£å¸¸åŠ è½½
âœ… èœå•çŠ¶æ€ä¿æŒ
```

### æµ‹è¯•åœºæ™¯ 3: ç‚¹å‡»å­èœå•

```bash
# 1. ç™»å½•ç³»ç»Ÿ
# 2. ç‚¹å‡» "ç³»ç»Ÿç®¡ç†"ï¼ˆå±•å¼€ï¼‰
# 3. ç‚¹å‡» "ç”¨æˆ·ç®¡ç†"

é¢„æœŸ:
âœ… è·¯ç”±è·³è½¬åˆ° /system/users
âœ… system-app æ­£å¸¸åŠ è½½
```

### æµ‹è¯•åœºæ™¯ 4: å…¶ä»–å­åº”ç”¨

```bash
# ç¡®è®¤ä¿®å¤ä¸å½±å“å…¶ä»–å­åº”ç”¨

æµ‹è¯•:
âœ… dashboard-app æ­£å¸¸
âœ… agent-app æ­£å¸¸
âœ… cluster-app æ­£å¸¸
âœ… monitor-app æ­£å¸¸
âœ… system-app æ­£å¸¸
```

## ğŸ“Š å½±å“èŒƒå›´

### ä¿®æ”¹çš„æ–‡ä»¶

- âœ… `main-app/src/main.js` - å”¯ä¸€ä¿®æ”¹

### å½±å“çš„åŠŸèƒ½

- âœ… æ‰€æœ‰å­åº”ç”¨çš„åŠ è½½æ—¶åº
- âœ… ç‰¹åˆ«æ˜¯å­èœå•è·¯ç”±çš„åŠ è½½
- âœ… é¡µé¢åˆ·æ–°æ—¶çš„å­åº”ç”¨åŠ è½½

### ä¸å½±å“çš„åŠŸèƒ½

- âœ… æ­£å¸¸çš„è·¯ç”±è·³è½¬
- âœ… ä¸€çº§èœå•çš„åŠ è½½
- âœ… å­åº”ç”¨ä¹‹é—´çš„åˆ‡æ¢

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. router.isReady() çš„ä½œç”¨

```javascript
router.isReady()
```

**ä½œç”¨**ï¼š
- ç­‰å¾…è·¯ç”±ç³»ç»Ÿå®Œå…¨åˆå§‹åŒ–
- ç­‰å¾…åˆå§‹å¯¼èˆªå®Œæˆ
- ç¡®ä¿å½“å‰è·¯ç”±å·²è§£æ

**è¿”å›**ï¼šPromise<void>

### 2. ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥åœ¨ mount åå¯åŠ¨ï¼Ÿ

å› ä¸º Vue 3 çš„ mount æ˜¯åŒæ­¥çš„ï¼Œä½†è·¯ç”±è§£ææ˜¯å¼‚æ­¥çš„ï¼š

```javascript
app.mount('#app')          // åŒæ­¥ï¼Œç«‹å³è¿”å›
// æ­¤æ—¶è·¯ç”±å¯èƒ½è¿˜åœ¨è§£æä¸­...

router.isReady()           // å¼‚æ­¥ï¼Œç­‰å¾…è·¯ç”±å‡†å¤‡å¥½
  .then(() => {
    // æ­¤æ—¶è·¯ç”±å·²å‡†å¤‡å¥½ï¼ŒMainLayout å·²æ¸²æŸ“
  })
```

### 3. æ€§èƒ½å½±å“

**å½±å“æå°**ï¼š
- `router.isReady()` é€šå¸¸åœ¨å‡ æ¯«ç§’å†…å®Œæˆ
- ç”¨æˆ·å‡ ä¹æ„Ÿè§‰ä¸åˆ°å»¶è¿Ÿ
- ä½†èƒ½é¿å…ä¸¥é‡çš„åŠ è½½é”™è¯¯

### 4. å…¶ä»–å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰

#### æ–¹æ¡ˆ 1: å»¶è¿Ÿå¯åŠ¨ï¼ˆä¸å¯é ï¼‰
```javascript
// âŒ ä¸æ¨è
setTimeout(() => {
  registerApps()
  startQiankun()
}, 100)
```

**é—®é¢˜**ï¼š
- å›ºå®šå»¶è¿Ÿä¸å¯é 
- å¯èƒ½å¤ªçŸ­ï¼ˆè¿˜æ²¡å‡†å¤‡å¥½ï¼‰
- å¯èƒ½å¤ªé•¿ï¼ˆå½±å“æ€§èƒ½ï¼‰

#### æ–¹æ¡ˆ 2: åœ¨ MainLayout mounted ä¸­å¯åŠ¨ï¼ˆè¿‡äºå¤æ‚ï¼‰
```javascript
// âŒ ä¸æ¨è
onMounted(() => {
  if (!window.__QIANKUN_STARTED__) {
    registerApps()
    startQiankun()
    window.__QIANKUN_STARTED__ = true
  }
})
```

**é—®é¢˜**ï¼š
- éœ€è¦å…¨å±€çŠ¶æ€
- ä»£ç åˆ†æ•£
- ç»´æŠ¤å›°éš¾

#### æ–¹æ¡ˆ 3: ä½¿ç”¨ router.isReady()ï¼ˆæ¨èï¼‰ âœ…
```javascript
// âœ… æ¨è
router.isReady().then(() => {
  registerApps()
  startQiankun()
})
```

**ä¼˜ç‚¹**ï¼š
- å®˜æ–¹APIï¼Œå¯é 
- ä»£ç é›†ä¸­
- è¯­ä¹‰æ¸…æ™°
- ç»´æŠ¤ç®€å•

## ğŸ“ æ€»ç»“

### é—®é¢˜æ ¹æº
- qiankun å¯åŠ¨æ—¶æœºè¿‡æ—©
- è·¯ç”±è¿˜æœªå‡†å¤‡å¥½
- å®¹å™¨è¿˜æœªæ¸²æŸ“

### è§£å†³æ–¹æ¡ˆ
- ä½¿ç”¨ `router.isReady()` ç­‰å¾…è·¯ç”±å‡†å¤‡
- ç¡®ä¿å®¹å™¨å­˜åœ¨åå†å¯åŠ¨ qiankun

### ä¿®æ”¹å†…å®¹
- ä»…ä¿®æ”¹ `main.js` ä¸€ä¸ªæ–‡ä»¶
- æ·»åŠ  3 è¡Œä»£ç 
- å®Œå…¨å‘åå…¼å®¹

### æ•ˆæœ
- âœ… æ‰€æœ‰å­åº”ç”¨æ­£å¸¸åŠ è½½
- âœ… å­èœå•è·¯ç”±æ­£å¸¸å·¥ä½œ
- âœ… é¡µé¢åˆ·æ–°æ­£å¸¸
- âœ… ç›´æ¥è®¿é—®å­è·¯ç”±æ­£å¸¸

---

**ä¿®å¤å®Œæˆï¼Œé—®é¢˜å·²è§£å†³ï¼** âœ…
