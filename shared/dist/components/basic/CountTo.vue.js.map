{"version":3,"file":"CountTo.vue.js","sources":["../../../src/components/basic/CountTo.vue"],"sourcesContent":["<template>\n  <span class=\"count-to\">{{ displayValue }}</span>\n</template>\n\n<script setup>\nimport { ref, watch, onMounted, onUnmounted } from 'vue'\n\nconst props = defineProps({\n  startVal: {\n    type: Number,\n    default: 0\n  },\n  endVal: {\n    type: Number,\n    required: true\n  },\n  duration: {\n    type: Number,\n    default: 2000\n  },\n  autoplay: {\n    type: Boolean,\n    default: true\n  },\n  decimals: {\n    type: Number,\n    default: 0\n  },\n  prefix: {\n    type: String,\n    default: ''\n  },\n  suffix: {\n    type: String,\n    default: ''\n  },\n  separator: {\n    type: String,\n    default: ','\n  },\n  decimal: {\n    type: String,\n    default: '.'\n  }\n})\n\nconst emit = defineEmits(['finished'])\n\nconst displayValue = ref('')\nlet animationFrameId = null\nlet startTime = null\n\nonMounted(() => {\n  if (props.autoplay) {\n    start()\n  }\n})\n\nonUnmounted(() => {\n  if (animationFrameId) {\n    cancelAnimationFrame(animationFrameId)\n  }\n})\n\nwatch(() => props.endVal, () => {\n  if (props.autoplay) {\n    restart()\n  }\n})\n\nconst formatNumber = (num) => {\n  const number = Number(num).toFixed(props.decimals)\n  const parts = number.split('.')\n  const integerPart = parts[0]\n  const decimalPart = parts[1]\n\n  // 添加千位分隔符\n  const formattedInteger = integerPart.replace(/\\B(?=(\\d{3})+(?!\\d))/g, props.separator)\n\n  // 组合结果\n  let result = formattedInteger\n  if (decimalPart) {\n    result += props.decimal + decimalPart\n  }\n\n  return props.prefix + result + props.suffix\n}\n\nconst count = (timestamp) => {\n  if (!startTime) {\n    startTime = timestamp\n  }\n\n  const progress = timestamp - startTime\n  const currentVal = props.startVal + (props.endVal - props.startVal) * Math.min(progress / props.duration, 1)\n\n  displayValue.value = formatNumber(currentVal)\n\n  if (progress < props.duration) {\n    animationFrameId = requestAnimationFrame(count)\n  } else {\n    displayValue.value = formatNumber(props.endVal)\n    emit('finished')\n  }\n}\n\nconst start = () => {\n  startTime = null\n  displayValue.value = formatNumber(props.startVal)\n  animationFrameId = requestAnimationFrame(count)\n}\n\nconst restart = () => {\n  if (animationFrameId) {\n    cancelAnimationFrame(animationFrameId)\n  }\n  start()\n}\n\ndefineExpose({\n  start,\n  restart\n})\n</script>\n\n<style scoped lang=\"scss\">\n.count-to {\n  display: inline-block;\n  font-variant-numeric: tabular-nums;\n}\n</style>\n"],"names":["_createElementBlock","_toDisplayString"],"mappings":"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"}