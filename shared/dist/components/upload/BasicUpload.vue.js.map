{"version":3,"file":"BasicUpload.vue.js","sources":["../../../src/components/upload/BasicUpload.vue"],"sourcesContent":["<template>\n  <a-upload\n    v-model:file-list=\"fileList\"\n    :action=\"action\"\n    :headers=\"headers\"\n    :data=\"data\"\n    :accept=\"accept\"\n    :multiple=\"multiple\"\n    :max-count=\"maxCount\"\n    :before-upload=\"handleBeforeUpload\"\n    :on-preview=\"handlePreview\"\n    :on-remove=\"handleRemove\"\n    :on-change=\"handleChange\"\n    :list-type=\"listType\"\n    :disabled=\"disabled\"\n    :show-upload-list=\"showUploadList\"\n  >\n    <slot>\n      <a-button v-if=\"listType !== 'picture-card'\" :disabled=\"disabled\">\n        <template #icon><UploadOutlined /></template>\n        {{ buttonText }}\n      </a-button>\n      <div v-else>\n        <plus-outlined />\n        <div class=\"ant-upload-text\">{{ buttonText }}</div>\n      </div>\n    </slot>\n  </a-upload>\n\n  <!-- 图片预览弹窗 -->\n  <a-modal\n    v-model:open=\"previewVisible\"\n    :footer=\"null\"\n    :title=\"previewTitle\"\n  >\n    <img :src=\"previewImage\" alt=\"preview\" style=\"width: 100%\" />\n  </a-modal>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\nimport { message } from 'ant-design-vue'\nimport { UploadOutlined, PlusOutlined } from '@ant-design/icons-vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    default: () => []\n  },\n  action: {\n    type: String,\n    required: true\n  },\n  headers: {\n    type: Object,\n    default: () => ({})\n  },\n  data: {\n    type: Object,\n    default: () => ({})\n  },\n  accept: {\n    type: String,\n    default: ''\n  },\n  multiple: {\n    type: Boolean,\n    default: false\n  },\n  maxCount: {\n    type: Number\n  },\n  maxSize: {\n    type: Number,\n    default: 5 // MB\n  },\n  listType: {\n    type: String,\n    default: 'text',\n    validator: (value) => ['text', 'picture', 'picture-card'].includes(value)\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  },\n  buttonText: {\n    type: String,\n    default: '上传文件'\n  },\n  showUploadList: {\n    type: [Boolean, Object],\n    default: true\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'change', 'preview', 'remove'])\n\nconst fileList = ref([])\nconst previewVisible = ref(false)\nconst previewImage = ref('')\nconst previewTitle = ref('')\n\nwatch(\n  () => props.modelValue,\n  (val) => {\n    fileList.value = val || []\n  },\n  { immediate: true }\n)\n\nconst handleBeforeUpload = (file) => {\n  // 检查文件大小\n  const isLtMaxSize = file.size / 1024 / 1024 < props.maxSize\n  if (!isLtMaxSize) {\n    message.error(`文件大小不能超过 ${props.maxSize}MB`)\n    return false\n  }\n\n  // 检查文件类型\n  if (props.accept) {\n    const acceptTypes = props.accept.split(',').map(type => type.trim())\n    const fileType = file.type\n    const fileName = file.name\n    const fileExt = fileName.substring(fileName.lastIndexOf('.')).toLowerCase()\n\n    const isAccepted = acceptTypes.some(type => {\n      if (type.startsWith('.')) {\n        return fileExt === type.toLowerCase()\n      }\n      return fileType.includes(type.replace('*', ''))\n    })\n\n    if (!isAccepted) {\n      message.error('文件格式不支持')\n      return false\n    }\n  }\n\n  return true\n}\n\nconst handleChange = ({ fileList: newFileList }) => {\n  fileList.value = newFileList\n  emit('update:modelValue', newFileList)\n  emit('change', newFileList)\n}\n\nconst handlePreview = async (file) => {\n  if (!file.url && !file.preview) {\n    file.preview = await getBase64(file.originFileObj)\n  }\n  previewImage.value = file.url || file.preview\n  previewVisible.value = true\n  previewTitle.value = file.name || file.url.substring(file.url.lastIndexOf('/') + 1)\n  emit('preview', file)\n}\n\nconst handleRemove = (file) => {\n  emit('remove', file)\n}\n\nconst getBase64 = (file) => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.readAsDataURL(file)\n    reader.onload = () => resolve(reader.result)\n    reader.onerror = (error) => reject(error)\n  })\n}\n</script>\n"],"names":[],"mappings":"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"}