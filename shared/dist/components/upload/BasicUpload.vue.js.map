{"version":3,"file":"BasicUpload.vue.js","sources":["../../../src/components/upload/BasicUpload.vue"],"sourcesContent":["<template>\n  <a-upload\n    v-model:file-list=\"fileList\"\n    :action=\"action\"\n    :headers=\"headers\"\n    :data=\"data\"\n    :accept=\"accept\"\n    :multiple=\"multiple\"\n    :max-count=\"maxCount\"\n    :before-upload=\"handleBeforeUpload\"\n    :on-preview=\"handlePreview\"\n    :on-remove=\"handleRemove\"\n    :on-change=\"handleChange\"\n    :list-type=\"listType\"\n    :disabled=\"disabled\"\n    :show-upload-list=\"showUploadList\"\n  >\n    <slot>\n      <a-button v-if=\"listType !== 'picture-card'\" :disabled=\"disabled\">\n        <template #icon><UploadOutlined /></template>\n        {{ buttonText }}\n      </a-button>\n      <div v-else>\n        <plus-outlined />\n        <div class=\"ant-upload-text\">{{ buttonText }}</div>\n      </div>\n    </slot>\n  </a-upload>\n\n  <!-- 图片预览弹窗 -->\n  <a-modal\n    v-model:open=\"previewVisible\"\n    :footer=\"null\"\n    :title=\"previewTitle\"\n  >\n    <img :src=\"previewImage\" alt=\"preview\" style=\"width: 100%\" />\n  </a-modal>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\nimport { message } from 'ant-design-vue'\nimport { UploadOutlined, PlusOutlined } from '@ant-design/icons-vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    default: () => []\n  },\n  action: {\n    type: String,\n    required: true\n  },\n  headers: {\n    type: Object,\n    default: () => ({})\n  },\n  data: {\n    type: Object,\n    default: () => ({})\n  },\n  accept: {\n    type: String,\n    default: ''\n  },\n  multiple: {\n    type: Boolean,\n    default: false\n  },\n  maxCount: {\n    type: Number\n  },\n  maxSize: {\n    type: Number,\n    default: 5 // MB\n  },\n  listType: {\n    type: String,\n    default: 'text',\n    validator: (value) => ['text', 'picture', 'picture-card'].includes(value)\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  },\n  buttonText: {\n    type: String,\n    default: '上传文件'\n  },\n  showUploadList: {\n    type: [Boolean, Object],\n    default: true\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'change', 'preview', 'remove'])\n\nconst fileList = ref([])\nconst previewVisible = ref(false)\nconst previewImage = ref('')\nconst previewTitle = ref('')\n\nwatch(\n  () => props.modelValue,\n  (val) => {\n    fileList.value = val || []\n  },\n  { immediate: true }\n)\n\nconst handleBeforeUpload = (file) => {\n  // 检查文件大小\n  const isLtMaxSize = file.size / 1024 / 1024 < props.maxSize\n  if (!isLtMaxSize) {\n    message.error(`文件大小不能超过 ${props.maxSize}MB`)\n    return false\n  }\n\n  // 检查文件类型\n  if (props.accept) {\n    const acceptTypes = props.accept.split(',').map(type => type.trim())\n    const fileType = file.type\n    const fileName = file.name\n    const fileExt = fileName.substring(fileName.lastIndexOf('.')).toLowerCase()\n\n    const isAccepted = acceptTypes.some(type => {\n      if (type.startsWith('.')) {\n        return fileExt === type.toLowerCase()\n      }\n      return fileType.includes(type.replace('*', ''))\n    })\n\n    if (!isAccepted) {\n      message.error('文件格式不支持')\n      return false\n    }\n  }\n\n  return true\n}\n\nconst handleChange = ({ fileList: newFileList }) => {\n  fileList.value = newFileList\n  emit('update:modelValue', newFileList)\n  emit('change', newFileList)\n}\n\nconst handlePreview = async (file) => {\n  if (!file.url && !file.preview) {\n    file.preview = await getBase64(file.originFileObj)\n  }\n  previewImage.value = file.url || file.preview\n  previewVisible.value = true\n  previewTitle.value = file.name || file.url.substring(file.url.lastIndexOf('/') + 1)\n  emit('preview', file)\n}\n\nconst handleRemove = (file) => {\n  emit('remove', file)\n}\n\nconst getBase64 = (file) => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.readAsDataURL(file)\n    reader.onload = () => resolve(reader.result)\n    reader.onerror = (error) => reject(error)\n  })\n}\n</script>\n"],"names":["_createVNode","_renderSlot","_createBlock","_unref","_createTextVNode","_createElementBlock","_createElementVNode","_toDisplayString"],"mappings":"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"}