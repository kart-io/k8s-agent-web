{"version":3,"file":"VxeBasicTable.vue.js","sources":["../../../src/components/vxe-table/VxeBasicTable.vue"],"sourcesContent":["<!--\n  VXE Table 基础表格组件\n  参考 vue-vben-admin 实现\n-->\n<template>\n  <div class=\"vxe-basic-table\" :class=\"{ 'is-full-screen': isFullScreen }\">\n    <!-- 表格标题 -->\n    <div v-if=\"title\" class=\"vxe-table-title\">\n      <div class=\"title-left\">\n        <slot name=\"title\">\n          <span class=\"title-text\">{{ title }}</span>\n        </slot>\n      </div>\n      <div class=\"title-right\">\n        <slot name=\"title-right\" />\n      </div>\n    </div>\n\n    <!-- VXE Grid 表格 -->\n    <div ref=\"gridContainer\" class=\"vxe-grid-container\">\n      <vxe-table\n        ref=\"gridRef\"\n        v-bind=\"tableOptions\"\n        :data=\"tableData\"\n        :loading=\"loading\"\n        class=\"vxe-table-main\"\n      >\n        <vxe-column\n          v-for=\"(col, index) in columns\"\n          :key=\"index\"\n          v-bind=\"col\"\n        >\n          <template v-if=\"col.slots?.default\" #default=\"scope\">\n            <slot :name=\"col.slots.default\" v-bind=\"scope\" />\n          </template>\n        </vxe-column>\n      </vxe-table>\n\n      <!-- 自定义分页器 -->\n      <div v-if=\"showPager\" class=\"vxe-custom-pager\">\n        <a-pagination\n          v-model:current=\"pagerConfig.currentPage\"\n          v-model:page-size=\"pagerConfig.pageSize\"\n          :total=\"pagerConfig.total\"\n          :show-total=\"total => `共 ${total} 条`\"\n          :show-size-changer=\"true\"\n          :page-size-options=\"['10', '20', '50', '100']\"\n          @change=\"handlePageChange\"\n          @show-size-change=\"handlePageChange\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, watch, onMounted, onActivated, nextTick } from 'vue'\n\nconst props = defineProps({\n  // 表格标题\n  title: {\n    type: String,\n    default: ''\n  },\n  // 表格配置\n  gridOptions: {\n    type: Object,\n    default: () => ({})\n  },\n  // 表格事件\n  gridEvents: {\n    type: Object,\n    default: () => ({})\n  },\n  // 表单配置\n  formOptions: {\n    type: Object,\n    default: () => ({})\n  },\n  // 是否显示工具栏\n  showToolbar: {\n    type: Boolean,\n    default: true\n  },\n  // 是否显示分页\n  showPager: {\n    type: Boolean,\n    default: true\n  },\n  // 是否立即加载\n  immediate: {\n    type: Boolean,\n    default: true\n  },\n  // 表格类名\n  tableClass: {\n    type: [String, Array, Object],\n    default: ''\n  },\n  // 表格样式\n  tableStyle: {\n    type: Object,\n    default: () => ({})\n  },\n  // API 请求方法\n  api: {\n    type: Function,\n    default: null\n  },\n  // 请求参数\n  params: {\n    type: Object,\n    default: () => ({})\n  },\n  // 数据源\n  dataSource: {\n    type: Array,\n    default: null\n  },\n  // 分页配置\n  pagination: {\n    type: [Object, Boolean],\n    default: () => ({})\n  },\n  // 是否自动高度\n  autoHeight: {\n    type: Boolean,\n    default: true\n  },\n  // 最大高度\n  maxHeight: {\n    type: [Number, String],\n    default: null\n  }\n})\n\nconst emit = defineEmits([\n  'register',\n  'checkbox-change',\n  'checkbox-all',\n  'page-change',\n  'sort-change',\n  'filter-change',\n  'toolbar-button-click',\n  'load-success',\n  'load-error'\n])\n\nconst isFullScreen = ref(false)\nconst gridContainer = ref(null)\nconst gridRef = ref(null)\nconst loading = ref(false)\nconst tableData = ref([])\nconst pagerConfig = ref({\n  currentPage: 1,\n  pageSize: 10,\n  total: 0\n})\n\n// 提取列配置\nconst columns = computed(() => {\n  return props.gridOptions?.columns || []\n})\n\n// 表格选项（不包含列）\nconst tableOptions = computed(() => {\n  const { columns: _, ...options } = props.gridOptions || {}\n  return {\n    border: 'inner',\n    round: true,\n    showOverflow: 'title',\n    showHeaderOverflow: 'title',\n    stripe: true,\n    align: 'left',\n    headerAlign: 'left',\n    rowConfig: {\n      isHover: true,\n      isCurrent: false\n    },\n    cellConfig: {\n      height: 54\n    },\n    columnConfig: {\n      resizable: true,\n      minWidth: 100\n    },\n    autoResize: true,\n    scrollY: {\n      enabled: true,\n      gt: 20\n    },\n    emptyText: '暂无数据',\n    ...options\n  }\n})\n\n// 加载数据\nconst loadData = async () => {\n  if (!props.api) {\n    // 如果没有 API，使用 dataSource\n    if (props.dataSource) {\n      tableData.value = props.dataSource\n    }\n    return\n  }\n\n  loading.value = true\n  console.log('[VxeBasicTable] loadData called, current page:', pagerConfig.value.currentPage)\n\n  try {\n    const params = {\n      page: pagerConfig.value.currentPage,\n      pageSize: pagerConfig.value.pageSize,\n      ...props.params\n    }\n\n    console.log('[VxeBasicTable] Calling API with params:', params)\n    const result = await props.api(params)\n    console.log('[VxeBasicTable] API result:', result)\n\n    if (result && result.data) {\n      tableData.value = result.data.list || result.data || []\n      pagerConfig.value.total = result.data.total || 0\n\n      console.log('[VxeBasicTable] Data loaded successfully, count:', tableData.value.length, 'total:', pagerConfig.value.total)\n      emit('load-success', result.data)\n    } else {\n      console.warn('[VxeBasicTable] API returned invalid data structure:', result)\n      tableData.value = []\n      pagerConfig.value.total = 0\n    }\n  } catch (error) {\n    console.error('[VxeBasicTable] 加载数据失败:', error)\n    tableData.value = []\n    pagerConfig.value.total = 0\n    emit('load-error', error)\n  } finally {\n    loading.value = false\n    console.log('[VxeBasicTable] loadData finished, loading:', loading.value, 'data count:', tableData.value.length)\n  }\n}\n\n// 分页变化\nconst handlePageChange = (page, pageSize) => {\n  pagerConfig.value.currentPage = page\n  pagerConfig.value.pageSize = pageSize\n  loadData()\n  emit('page-change', { currentPage: page, pageSize })\n}\n\n// 暴露的 API 方法\nconst tableApi = {\n  reload: () => {\n    pagerConfig.value.currentPage = 1\n    loadData()\n  },\n  query: () => {\n    pagerConfig.value.currentPage = 1\n    loadData()\n  },\n  refresh: () => {\n    loadData()\n  },\n  getTableData: () => tableData.value,\n  setTableData: (data) => {\n    tableData.value = data\n  }\n}\n\n// 监听 dataSource 变化\nwatch(() => props.dataSource, (newVal) => {\n  if (newVal && !props.api) {\n    tableData.value = newVal\n  }\n}, { immediate: true })\n\n// 监听 params 变化\nwatch(() => props.params, () => {\n  if (props.api) {\n    loadData()\n  }\n}, { deep: true })\n\n// 组件挂载\nonMounted(() => {\n  console.log('[VxeBasicTable] Component mounted, immediate:', props.immediate, 'has api:', !!props.api)\n  nextTick(() => {\n    console.log('[VxeBasicTable] nextTick, emitting register event')\n    emit('register', tableApi)\n\n    if (props.immediate && props.api) {\n      console.log('[VxeBasicTable] immediate is true and api exists, calling loadData()')\n      loadData()\n    } else {\n      console.log('[VxeBasicTable] Skipping initial loadData, immediate:', props.immediate, 'api:', !!props.api)\n    }\n  })\n})\n\n// 组件激活（用于 keep-alive 场景，如 Wujie 微前端）\n// 注意：这个钩子只在使用 <keep-alive> 包裹的组件中才会触发\n// Wujie 的 alive 模式在主应用层面实现 keep-alive，子应用内部的组件不会触发 onActivated\n// 所以这个钩子主要用于子应用内部使用 keep-alive 的场景\nonActivated(() => {\n  console.log('[VxeBasicTable] onActivated triggered')\n  // 在 keep-alive 场景中，组件激活时刷新数据\n  if (props.immediate && props.api && tableData.value.length === 0) {\n    console.log('[VxeBasicTable] onActivated: loading data because tableData is empty')\n    loadData()\n  }\n})\n\n// 暴露 API 方法\ndefineExpose({\n  gridContainer,\n  gridRef,\n  ...tableApi\n})\n</script>\n\n<style scoped lang=\"scss\">\n.vxe-basic-table {\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: #fff;\n  border-radius: 2px;\n\n  &.is-full-screen {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    background: #fff;\n    padding: 16px;\n  }\n\n  .vxe-table-title {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px 20px;\n    background: #fafafa;\n    border-bottom: 1px solid #f0f0f0;\n    flex-shrink: 0;\n\n    .title-left {\n      flex: 1;\n\n      .title-text {\n        font-size: 16px;\n        font-weight: 600;\n        color: rgba(0, 0, 0, 0.85);\n      }\n    }\n\n    .title-right {\n      flex-shrink: 0;\n      margin-left: 16px;\n    }\n  }\n\n  .vxe-grid-container {\n    flex: 1;\n    min-height: 200px;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    padding: 16px;\n  }\n\n  .vxe-table-main {\n    flex: 1;\n    min-height: 0;\n  }\n\n  .vxe-table-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-height: 400px;\n    border: 1px dashed #d9d9d9;\n    border-radius: 4px;\n  }\n\n  .vxe-custom-pager {\n    display: flex;\n    justify-content: flex-end;\n    padding: 16px 0 0 0;\n    flex-shrink: 0;\n  }\n\n  // VXE Table 样式优化\n  :deep(.vxe-table) {\n    border-radius: 4px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n    background: #fff;\n\n    // 表头样式\n    .vxe-table--header-wrapper {\n      background: #fafafa;\n\n      .vxe-header--row {\n        .vxe-header--column {\n          background: #fafafa !important;\n          font-weight: 600;\n          color: rgba(0, 0, 0, 0.85);\n          font-size: 14px;\n          border-bottom: 1px solid #f0f0f0;\n\n          .vxe-cell {\n            padding: 14px 16px;\n            line-height: 1.5715;\n          }\n        }\n      }\n    }\n\n    // 表体样式\n    .vxe-table--body-wrapper {\n      background: #fff;\n\n      .vxe-body--row {\n        background: #fff !important;\n        transition: background-color 0.2s ease;\n\n        &:hover {\n          background-color: #fafafa !important;\n        }\n\n        &.row--stripe {\n          background-color: #fff !important;\n\n          &:hover {\n            background-color: #fafafa !important;\n          }\n        }\n\n        .vxe-body--column {\n          background: #fff !important;\n          color: rgba(0, 0, 0, 0.85);\n          font-size: 14px;\n          border-bottom: 1px solid #f0f0f0;\n\n          .vxe-cell {\n            padding: 14px 16px;\n            line-height: 1.5715;\n          }\n\n          // 序号列特殊样式\n          &.col--seq .vxe-cell {\n            color: rgba(0, 0, 0, 0.45);\n            font-weight: normal;\n          }\n        }\n\n        // 最后一行不显示底部边框\n        &:last-child .vxe-body--column {\n          border-bottom: none;\n        }\n      }\n    }\n\n    // 边框样式\n    &.border--inner,\n    &.border--default {\n      border: 1px solid #f0f0f0;\n\n      .vxe-table--header-wrapper,\n      .vxe-table--body-wrapper,\n      .vxe-table--footer-wrapper {\n        .vxe-header--column,\n        .vxe-body--column,\n        .vxe-footer--column {\n          border-right: 1px solid #f0f0f0;\n\n          &:last-child {\n            border-right: none;\n          }\n        }\n      }\n    }\n\n    // 空数据样式\n    .vxe-table--empty-block {\n      padding: 80px 0;\n\n      .vxe-table--empty-content {\n        color: rgba(0, 0, 0, 0.25);\n        font-size: 14px;\n      }\n    }\n\n    // Loading 样式\n    .vxe-table--loading {\n      .vxe-table--spinner {\n        background: rgba(255, 255, 255, 0.9);\n      }\n    }\n  }\n}\n</style>\n"],"names":[],"mappings":"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"}