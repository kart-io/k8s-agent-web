{"version":3,"file":"useForm.js","sources":["../../src/composables/useForm.js"],"sourcesContent":["import { ref, reactive, unref } from 'vue'\n\n/**\n * 表单组合函数\n * 简化表单的验证、提交、重置等操作\n */\nexport function useForm(options = {}) {\n  const {\n    schemas = [],\n    initialValues = {},\n    onSubmit,\n    onReset\n  } = options\n\n  // 表单引用\n  const formRef = ref(null)\n\n  // 表单数据\n  const formModel = reactive({ ...initialValues })\n\n  // 提交加载状态\n  const submitLoading = ref(false)\n\n  /**\n   * 验证表单\n   */\n  const validate = async () => {\n    if (!formRef.value) {\n      console.warn('useForm: formRef is not ready')\n      return false\n    }\n\n    try {\n      await formRef.value.validate()\n      return true\n    } catch (error) {\n      console.error('Form validation failed:', error)\n      return false\n    }\n  }\n\n  /**\n   * 验证指定字段\n   */\n  const validateFields = async (fields) => {\n    if (!formRef.value) {\n      return false\n    }\n\n    try {\n      await formRef.value.validateFields(fields)\n      return true\n    } catch (error) {\n      console.error('Fields validation failed:', error)\n      return false\n    }\n  }\n\n  /**\n   * 清除验证\n   */\n  const clearValidate = (fields) => {\n    formRef.value?.clearValidate(fields)\n  }\n\n  /**\n   * 重置表单\n   */\n  const resetFields = (fields) => {\n    formRef.value?.resetFields(fields)\n\n    if (onReset) {\n      onReset()\n    }\n  }\n\n  /**\n   * 设置字段值\n   */\n  const setFieldsValue = (values) => {\n    Object.assign(formModel, values)\n  }\n\n  /**\n   * 获取字段值\n   */\n  const getFieldsValue = () => {\n    return { ...formModel }\n  }\n\n  /**\n   * 提交表单\n   */\n  const handleSubmit = async () => {\n    const isValid = await validate()\n\n    if (!isValid) {\n      return false\n    }\n\n    if (!onSubmit) {\n      return true\n    }\n\n    try {\n      submitLoading.value = true\n      await onSubmit(formModel)\n      return true\n    } catch (error) {\n      console.error('Form submit failed:', error)\n      return false\n    } finally {\n      submitLoading.value = false\n    }\n  }\n\n  /**\n   * 重置表单\n   */\n  const handleReset = () => {\n    resetFields()\n  }\n\n  /**\n   * 设置表单引用\n   */\n  const setFormRef = (ref) => {\n    formRef.value = ref\n  }\n\n  return {\n    formRef,\n    formModel,\n    submitLoading,\n    schemas,\n    validate,\n    validateFields,\n    clearValidate,\n    resetFields,\n    setFieldsValue,\n    getFieldsValue,\n    handleSubmit,\n    handleReset,\n    setFormRef\n  }\n}\n"],"names":[],"mappings":"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"}