{"version":3,"file":"useModal.js","sources":["../../src/composables/useModal.js"],"sourcesContent":["import { ref, reactive, unref } from 'vue'\n\n/**\n * 模态框组合函数\n * 简化模态框的打开、关闭、提交等操作\n */\nexport function useModal(options = {}) {\n  const {\n    onOk,\n    onCancel,\n    afterClose\n  } = options\n\n  // 可见性\n  const visible = ref(false)\n\n  // 确认加载状态\n  const confirmLoading = ref(false)\n\n  // 模态框数据\n  const modalData = reactive({})\n\n  /**\n   * 打开模态框\n   */\n  const open = (data = {}) => {\n    visible.value = true\n    Object.assign(modalData, data)\n  }\n\n  /**\n   * 关闭模态框\n   */\n  const close = () => {\n    visible.value = false\n  }\n\n  /**\n   * 确定按钮处理\n   */\n  const handleOk = async () => {\n    if (!onOk) {\n      close()\n      return\n    }\n\n    try {\n      confirmLoading.value = true\n      await onOk(modalData)\n      close()\n    } catch (error) {\n      console.error('Modal ok failed:', error)\n      // 不关闭模态框，让用户可以修改\n    } finally {\n      confirmLoading.value = false\n    }\n  }\n\n  /**\n   * 取消按钮处理\n   */\n  const handleCancel = () => {\n    if (onCancel) {\n      onCancel()\n    }\n    close()\n  }\n\n  /**\n   * 关闭后回调\n   */\n  const handleAfterClose = () => {\n    // 清空数据\n    Object.keys(modalData).forEach(key => {\n      delete modalData[key]\n    })\n\n    if (afterClose) {\n      afterClose()\n    }\n  }\n\n  /**\n   * 设置模态框数据\n   */\n  const setModalData = (data = {}) => {\n    Object.assign(modalData, data)\n  }\n\n  /**\n   * 重置模态框数据\n   */\n  const resetModalData = () => {\n    Object.keys(modalData).forEach(key => {\n      delete modalData[key]\n    })\n  }\n\n  /**\n   * 设置加载状态\n   */\n  const setConfirmLoading = (loading) => {\n    confirmLoading.value = loading\n  }\n\n  return {\n    visible,\n    confirmLoading,\n    modalData,\n    open,\n    close,\n    handleOk,\n    handleCancel,\n    handleAfterClose,\n    setModalData,\n    resetModalData,\n    setConfirmLoading\n  }\n}\n"],"names":[],"mappings":";;AAEA;AACA;AACA;AACA;AACO,SAAS,QAAQ,CAAC,OAAO,GAAG,EAAE,EAAE;AACvC,EAAE,MAAM;AACR,IAAI,IAAI;AACR,IAAI,QAAQ;AACZ,IAAI,UAAU;AACd,GAAG,GAAG,QAAO;AACb;AACA;AACA,EAAE,MAAM,OAAO,GAAG,GAAG,CAAC,KAAK,EAAC;AAC5B;AACA;AACA,EAAE,MAAM,cAAc,GAAG,GAAG,CAAC,KAAK,EAAC;AACnC;AACA;AACA,EAAE,MAAM,SAAS,GAAG,QAAQ,CAAC,EAAE,EAAC;AAChC;AACA;AACA;AACA;AACA,EAAE,MAAM,IAAI,GAAG,CAAC,IAAI,GAAG,EAAE,KAAK;AAC9B,IAAI,OAAO,CAAC,KAAK,GAAG,KAAI;AACxB,IAAI,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,EAAC;AAClC,IAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,KAAK,GAAG,MAAM;AACtB,IAAI,OAAO,CAAC,KAAK,GAAG,MAAK;AACzB,IAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,QAAQ,GAAG,YAAY;AAC/B,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,KAAK,GAAE;AACb,MAAM,MAAM;AACZ,KAAK;AACL;AACA,IAAI,IAAI;AACR,MAAM,cAAc,CAAC,KAAK,GAAG,KAAI;AACjC,MAAM,MAAM,IAAI,CAAC,SAAS,EAAC;AAC3B,MAAM,KAAK,GAAE;AACb,KAAK,CAAC,OAAO,KAAK,EAAE;AACpB,MAAM,OAAO,CAAC,KAAK,CAAC,kBAAkB,EAAE,KAAK,EAAC;AAC9C;AACA,KAAK,SAAS;AACd,MAAM,cAAc,CAAC,KAAK,GAAG,MAAK;AAClC,KAAK;AACL,IAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,YAAY,GAAG,MAAM;AAC7B,IAAI,IAAI,QAAQ,EAAE;AAClB,MAAM,QAAQ,GAAE;AAChB,KAAK;AACL,IAAI,KAAK,GAAE;AACX,IAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,gBAAgB,GAAG,MAAM;AACjC;AACA,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,GAAG,IAAI;AAC1C,MAAM,OAAO,SAAS,CAAC,GAAG,EAAC;AAC3B,KAAK,EAAC;AACN;AACA,IAAI,IAAI,UAAU,EAAE;AACpB,MAAM,UAAU,GAAE;AAClB,KAAK;AACL,IAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,YAAY,GAAG,CAAC,IAAI,GAAG,EAAE,KAAK;AACtC,IAAI,MAAM,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,EAAC;AAClC,IAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,cAAc,GAAG,MAAM;AAC/B,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,GAAG,IAAI;AAC1C,MAAM,OAAO,SAAS,CAAC,GAAG,EAAC;AAC3B,KAAK,EAAC;AACN,IAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,iBAAiB,GAAG,CAAC,OAAO,KAAK;AACzC,IAAI,cAAc,CAAC,KAAK,GAAG,QAAO;AAClC,IAAG;AACH;AACA,EAAE,OAAO;AACT,IAAI,OAAO;AACX,IAAI,cAAc;AAClB,IAAI,SAAS;AACb,IAAI,IAAI;AACR,IAAI,KAAK;AACT,IAAI,QAAQ;AACZ,IAAI,YAAY;AAChB,IAAI,gBAAgB;AACpB,IAAI,YAAY;AAChB,IAAI,cAAc;AAClB,IAAI,iBAAiB;AACrB,GAAG;AACH;;;;"}