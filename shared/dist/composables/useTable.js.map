{"version":3,"file":"useTable.js","sources":["../../src/composables/useTable.js"],"sourcesContent":["import { ref, reactive, unref, computed, watch } from 'vue'\n\n/**\n * 表格组合函数\n * 用于简化表格操作，包括加载、分页、搜索等\n */\nexport function useTable(options = {}) {\n  const {\n    api,\n    immediate = true,\n    searchParams = {},\n    pagination: paginationOptions = {}\n  } = options\n\n  // 表格数据\n  const dataSource = ref([])\n\n  // 加载状态\n  const loading = ref(false)\n\n  // 分页信息\n  const pagination = reactive({\n    current: 1,\n    pageSize: 10,\n    total: 0,\n    showSizeChanger: true,\n    showQuickJumper: true,\n    showTotal: (total) => `共 ${total} 条`,\n    ...paginationOptions\n  })\n\n  // 搜索参数\n  const search = reactive({ ...searchParams })\n\n  /**\n   * 加载数据\n   */\n  const loadData = async (params = {}) => {\n    if (!api) {\n      console.warn('useTable: api is required')\n      return\n    }\n\n    try {\n      loading.value = true\n\n      const requestParams = {\n        ...search,\n        ...params,\n        page: pagination.current,\n        pageSize: pagination.pageSize\n      }\n\n      const result = await api(requestParams)\n\n      // 支持不同的返回格式\n      if (Array.isArray(result)) {\n        dataSource.value = result\n      } else if (result.data) {\n        dataSource.value = result.data\n        pagination.total = result.total || 0\n      } else {\n        dataSource.value = []\n      }\n    } catch (error) {\n      console.error('Failed to load table data:', error)\n      dataSource.value = []\n    } finally {\n      loading.value = false\n    }\n  }\n\n  /**\n   * 刷新数据（保持当前页）\n   */\n  const reload = async (params = {}) => {\n    await loadData(params)\n  }\n\n  /**\n   * 重新加载（重置到第一页）\n   */\n  const reset = async (params = {}) => {\n    pagination.current = 1\n    await loadData(params)\n  }\n\n  /**\n   * 设置搜索参数\n   */\n  const setSearch = (params = {}) => {\n    Object.assign(search, params)\n    reset()\n  }\n\n  /**\n   * 重置搜索参数\n   */\n  const resetSearch = () => {\n    Object.keys(search).forEach(key => {\n      search[key] = searchParams[key] || undefined\n    })\n    reset()\n  }\n\n  /**\n   * 表格变化处理（分页、排序、筛选）\n   */\n  const handleTableChange = (pag, filters, sorter) => {\n    pagination.current = pag.current\n    pagination.pageSize = pag.pageSize\n\n    const params = {}\n\n    // 处理排序\n    if (sorter && sorter.field) {\n      params.sortField = sorter.field\n      params.sortOrder = sorter.order\n    }\n\n    // 处理筛选\n    if (filters) {\n      Object.assign(params, filters)\n    }\n\n    loadData(params)\n  }\n\n  /**\n   * 删除后刷新\n   */\n  const deleteAndReload = async (deleteFn) => {\n    try {\n      await deleteFn()\n\n      // 如果删除后当前页没数据了，回到上一页\n      if (dataSource.value.length === 1 && pagination.current > 1) {\n        pagination.current--\n      }\n\n      await reload()\n    } catch (error) {\n      console.error('Delete failed:', error)\n    }\n  }\n\n  // 立即加载\n  if (immediate && api) {\n    loadData()\n  }\n\n  return {\n    dataSource,\n    loading,\n    pagination,\n    search,\n    loadData,\n    reload,\n    reset,\n    setSearch,\n    resetSearch,\n    handleTableChange,\n    deleteAndReload\n  }\n}\n"],"names":[],"mappings":"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"}