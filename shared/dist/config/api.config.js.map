{"version":3,"file":"api.config.js","sources":["../../src/config/api.config.js"],"sourcesContent":["/**\n * Unified API Configuration for K8s Agent Web\n * Feature 003: Project Structure Optimization\n *\n * This module provides centralized API configuration for all micro-apps,\n * ensuring consistent request/response handling, error management, and\n * authentication across the entire application.\n *\n * @module @k8s-agent/shared/config/api\n */\n\nimport axios from 'axios'\n\n/**\n * Default API configuration\n * Can be overridden by individual applications\n */\nexport const DEFAULT_CONFIG = {\n  // Base URL for API requests\n  baseURL: '/api',\n\n  // Request timeout in milliseconds\n  timeout: 30000,\n\n  // Request headers\n  headers: {\n    'Content-Type': 'application/json'\n  },\n\n  // Enable credentials for cross-origin requests\n  withCredentials: false\n}\n\n/**\n * Environment-specific configurations\n */\nexport const ENV_CONFIGS = {\n  development: {\n    baseURL: '/api',\n    timeout: 30000\n  },\n  test: {\n    baseURL: 'https://test-api.example.com/api',\n    timeout: 20000\n  },\n  production: {\n    baseURL: 'https://api.example.com/api',\n    timeout: 15000\n  }\n}\n\n/**\n * Get environment-aware configuration\n * @param {string} env - Environment name (development|test|production)\n * @returns {Object} Merged configuration\n */\nexport function getEnvConfig(env = import.meta.env.MODE) {\n  const envConfig = ENV_CONFIGS[env] || ENV_CONFIGS.development\n  return { ...DEFAULT_CONFIG, ...envConfig }\n}\n\n/**\n * Default request interceptor\n * Adds authorization token to all requests\n *\n * @param {Object} config - Axios request config\n * @returns {Object} Modified config\n */\nexport function defaultRequestInterceptor(config) {\n  // Get token from localStorage (can be customized)\n  const token = localStorage.getItem('token')\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`\n  }\n\n  // Add timestamp for cache busting\n  if (config.method === 'get') {\n    config.params = {\n      ...config.params,\n      _t: Date.now()\n    }\n  }\n\n  return config\n}\n\n/**\n * Default request error handler\n * @param {Error} error - Request error\n * @returns {Promise} Rejected promise\n */\nexport function defaultRequestErrorHandler(error) {\n  console.error('[API Request Error]', error)\n  return Promise.reject(error)\n}\n\n/**\n * Default response interceptor\n * Extracts data from response and handles common response formats\n *\n * @param {Object} response - Axios response\n * @returns {Object} Response data\n */\nexport function defaultResponseInterceptor(response) {\n  const res = response.data\n\n  // Standard response format: { code, data, message }\n  if (res && typeof res === 'object') {\n    // Success response codes: 0, 200, '0', '200'\n    const successCodes = [0, 200, '0', '200']\n    if ('code' in res) {\n      if (successCodes.includes(res.code)) {\n        return res.data !== undefined ? res.data : res\n      } else {\n        // Business logic error\n        const error = new Error(res.message || 'Business logic error')\n        error.code = res.code\n        error.response = response\n        return Promise.reject(error)\n      }\n    }\n\n    // Direct data response\n    return res\n  }\n\n  // Return raw response for non-object data\n  return response.data\n}\n\n/**\n * Default response error handler\n * Handles HTTP errors and authentication issues\n *\n * @param {Error} error - Response error\n * @param {Object} options - Error handling options\n * @param {Function} options.onUnauthorized - 401 handler\n * @param {Function} options.onForbidden - 403 handler\n * @param {Function} options.onNotFound - 404 handler\n * @param {Function} options.onServerError - 5xx handler\n * @param {Function} options.showMessage - Message display function\n * @returns {Promise} Rejected promise\n */\nexport function defaultResponseErrorHandler(error, options = {}) {\n  const {\n    onUnauthorized,\n    onForbidden,\n    onNotFound,\n    onServerError,\n    showMessage\n  } = options\n\n  if (!error.response) {\n    // Network error\n    const message = 'Network error, please check your connection'\n    if (showMessage) showMessage(message, 'error')\n    console.error('[Network Error]', error)\n    return Promise.reject(error)\n  }\n\n  const { status, data } = error.response\n  let message = data?.message || data?.error || error.message || 'Request failed'\n\n  switch (status) {\n    case 401:\n      // Unauthorized - clear auth and redirect to login\n      message = 'Authentication failed, please login again'\n      if (onUnauthorized) {\n        onUnauthorized()\n      } else {\n        // Default behavior\n        localStorage.removeItem('token')\n        localStorage.removeItem('userInfo')\n        if (typeof window !== 'undefined') {\n          window.location.href = '/login'\n        }\n      }\n      break\n\n    case 403:\n      // Forbidden\n      message = 'Access denied'\n      if (onForbidden) onForbidden()\n      break\n\n    case 404:\n      // Not Found\n      message = 'Resource not found'\n      if (onNotFound) onNotFound()\n      break\n\n    case 500:\n    case 502:\n    case 503:\n    case 504:\n      // Server errors\n      message = 'Server error, please try again later'\n      if (onServerError) onServerError()\n      break\n\n    default:\n      // Other errors\n      break\n  }\n\n  if (showMessage) showMessage(message, 'error')\n  console.error(`[API Error ${status}]`, message, data)\n\n  return Promise.reject(error)\n}\n\n/**\n * Create configured axios instance\n *\n * @param {Object} customConfig - Custom configuration to override defaults\n * @param {Object} interceptorOptions - Custom interceptor options\n * @param {Function} interceptorOptions.requestInterceptor - Custom request interceptor\n * @param {Function} interceptorOptions.requestErrorHandler - Custom request error handler\n * @param {Function} interceptorOptions.responseInterceptor - Custom response interceptor\n * @param {Function} interceptorOptions.responseErrorHandler - Custom response error handler\n * @returns {import('axios').AxiosInstance} Configured axios instance\n *\n * @example\n * // Basic usage\n * import { createApiInstance } from '@k8s-agent/shared/config/api'\n * const api = createApiInstance()\n *\n * @example\n * // Custom configuration\n * const api = createApiInstance({\n *   baseURL: '/custom-api',\n *   timeout: 5000\n * })\n *\n * @example\n * // With Ant Design Vue message\n * import { message } from 'ant-design-vue'\n * const api = createApiInstance({}, {\n *   responseErrorHandler: (error) => defaultResponseErrorHandler(error, {\n *     showMessage: (msg, type) => message[type](msg)\n *   })\n * })\n */\nexport function createApiInstance(customConfig = {}, interceptorOptions = {}) {\n  const {\n    requestInterceptor = defaultRequestInterceptor,\n    requestErrorHandler = defaultRequestErrorHandler,\n    responseInterceptor = defaultResponseInterceptor,\n    responseErrorHandler = defaultResponseErrorHandler\n  } = interceptorOptions\n\n  // Merge configurations\n  const config = {\n    ...getEnvConfig(),\n    ...customConfig\n  }\n\n  // Create axios instance\n  const instance = axios.create(config)\n\n  // Register request interceptors\n  instance.interceptors.request.use(\n    requestInterceptor,\n    requestErrorHandler\n  )\n\n  // Register response interceptors\n  instance.interceptors.response.use(\n    responseInterceptor,\n    responseErrorHandler\n  )\n\n  return instance\n}\n\n/**\n * Pre-configured API instance with default settings\n * Can be used directly in applications\n */\nexport const api = createApiInstance()\n\n/**\n * Export axios for direct access if needed\n */\nexport { axios }\n\n/**\n * Utility function to create URL with query parameters\n * @param {string} url - Base URL\n * @param {Object} params - Query parameters\n * @returns {string} URL with query string\n */\nexport function createUrl(url, params = {}) {\n  const queryString = Object.keys(params)\n    .filter((key) => params[key] !== undefined && params[key] !== null)\n    .map((key) => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\n    .join('&')\n\n  return queryString ? `${url}?${queryString}` : url\n}\n\n/**\n * Utility function to handle file downloads\n * @param {Object} response - Axios response with blob data\n * @param {string} filename - Suggested filename\n */\nexport function downloadFile(response, filename) {\n  const url = window.URL.createObjectURL(new Blob([response.data]))\n  const link = document.createElement('a')\n  link.href = url\n  link.setAttribute('download', filename)\n  document.body.appendChild(link)\n  link.click()\n  document.body.removeChild(link)\n  window.URL.revokeObjectURL(url)\n}\n\nexport default {\n  DEFAULT_CONFIG,\n  ENV_CONFIGS,\n  getEnvConfig,\n  createApiInstance,\n  createUrl,\n  downloadFile,\n  api,\n  axios,\n  // Interceptors\n  defaultRequestInterceptor,\n  defaultRequestErrorHandler,\n  defaultResponseInterceptor,\n  defaultResponseErrorHandler\n}\n"],"names":["message"],"mappings":";;;AAiBO,MAAM,cAAA,GAAiB;AAAA;AAAA,EAE5B,OAAA,EAAS,MAAA;AAAA;AAAA,EAGT,OAAA,EAAS,GAAA;AAAA;AAAA,EAGT,OAAA,EAAS;AAAA,IACP,cAAA,EAAgB;AAAA,GAClB;AAAA;AAAA,EAGA,eAAA,EAAiB;AACnB;AAKO,MAAM,WAAA,GAAc;AAAA,EACzB,WAAA,EAAa;AAAA,IACX,OAAA,EAAS,MAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA,IAAA,EAAM;AAAA,IACJ,OAAA,EAAS,kCAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA,UAAA,EAAY;AAAA,IACV,OAAA,EAAS,6BAAA;AAAA,IACT,OAAA,EAAS;AAAA;AAEb;AAOO,SAAS,YAAA,CAAa,MAAM,YAAA,EAAsB;AACvD,EAAA,MAAM,SAAA,GAAY,WAAA,CAAY,GAAG,CAAA,IAAK,WAAA,CAAY,WAAA;AAClD,EAAA,OAAO,EAAE,GAAG,cAAA,EAAgB,GAAG,SAAA,EAAU;AAC3C;AASO,SAAS,0BAA0B,MAAA,EAAQ;AAEhD,EAAA,MAAM,KAAA,GAAQ,YAAA,CAAa,OAAA,CAAQ,OAAO,CAAA;AAC1C,EAAA,IAAI,KAAA,EAAO;AACT,IAAA,MAAA,CAAO,OAAA,CAAQ,aAAA,GAAgB,CAAA,OAAA,EAAU,KAAK,CAAA,CAAA;AAAA,EAChD;AAGA,EAAA,IAAI,MAAA,CAAO,WAAW,KAAA,EAAO;AAC3B,IAAA,MAAA,CAAO,MAAA,GAAS;AAAA,MACd,GAAG,MAAA,CAAO,MAAA;AAAA,MACV,EAAA,EAAI,KAAK,GAAA;AAAI,KACf;AAAA,EACF;AAEA,EAAA,OAAO,MAAA;AACT;AAOO,SAAS,2BAA2B,KAAA,EAAO;AAChD,EAAA,OAAA,CAAQ,KAAA,CAAM,uBAAuB,KAAK,CAAA;AAC1C,EAAA,OAAO,OAAA,CAAQ,OAAO,KAAK,CAAA;AAC7B;AASO,SAAS,2BAA2B,QAAA,EAAU;AACnD,EAAA,MAAM,MAAM,QAAA,CAAS,IAAA;AAGrB,EAAA,IAAI,GAAA,IAAO,OAAO,GAAA,KAAQ,QAAA,EAAU;AAElC,IAAA,MAAM,YAAA,GAAe,CAAC,CAAA,EAAG,GAAA,EAAK,KAAK,KAAK,CAAA;AACxC,IAAA,IAAI,UAAU,GAAA,EAAK;AACjB,MAAA,IAAI,YAAA,CAAa,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA,EAAG;AACnC,QAAA,OAAO,GAAA,CAAI,IAAA,KAAS,MAAA,GAAY,GAAA,CAAI,IAAA,GAAO,GAAA;AAAA,MAC7C,CAAA,MAAO;AAEL,QAAA,MAAM,KAAA,GAAQ,IAAI,KAAA,CAAM,GAAA,CAAI,WAAW,sBAAsB,CAAA;AAC7D,QAAA,KAAA,CAAM,OAAO,GAAA,CAAI,IAAA;AACjB,QAAA,KAAA,CAAM,QAAA,GAAW,QAAA;AACjB,QAAA,OAAO,OAAA,CAAQ,OAAO,KAAK,CAAA;AAAA,MAC7B;AAAA,IACF;AAGA,IAAA,OAAO,GAAA;AAAA,EACT;AAGA,EAAA,OAAO,QAAA,CAAS,IAAA;AAClB;AAeO,SAAS,2BAAA,CAA4B,KAAA,EAAO,OAAA,GAAU,EAAC,EAAG;AAC/D,EAAA,MAAM;AAAA,IACJ,cAAA;AAAA,IACA,WAAA;AAAA,IACA,UAAA;AAAA,IACA,aAAA;AAAA,IACA;AAAA,GACF,GAAI,OAAA;AAEJ,EAAA,IAAI,CAAC,MAAM,QAAA,EAAU;AAEnB,IAAA,MAAMA,QAAAA,GAAU,6CAAA;AAChB,IAAA,IAAI,WAAA;AAAa,MAAA,WAAA,CAAYA,UAAS,OAAO,CAAA;AAC7C,IAAA,OAAA,CAAQ,KAAA,CAAM,mBAAmB,KAAK,CAAA;AACtC,IAAA,OAAO,OAAA,CAAQ,OAAO,KAAK,CAAA;AAAA,EAC7B;AAEA,EAAA,MAAM,EAAE,MAAA,EAAQ,IAAA,EAAK,GAAI,KAAA,CAAM,QAAA;AAC/B,EAAA,IAAI,UAAU,IAAA,EAAM,OAAA,IAAW,IAAA,EAAM,KAAA,IAAS,MAAM,OAAA,IAAW,gBAAA;AAE/D,EAAA,QAAQ,MAAA;AAAQ,IACd,KAAK,GAAA;AAEH,MAAA,OAAA,GAAU,2CAAA;AACV,MAAA,IAAI,cAAA,EAAgB;AAClB,QAAA,cAAA,EAAe;AAAA,MACjB,CAAA,MAAO;AAEL,QAAA,YAAA,CAAa,WAAW,OAAO,CAAA;AAC/B,QAAA,YAAA,CAAa,WAAW,UAAU,CAAA;AAClC,QAAA,IAAI,OAAO,WAAW,WAAA,EAAa;AACjC,UAAA,MAAA,CAAO,SAAS,IAAA,GAAO,QAAA;AAAA,QACzB;AAAA,MACF;AACA,MAAA;AAAA,IAEF,KAAK,GAAA;AAEH,MAAA,OAAA,GAAU,eAAA;AACV,MAAA,IAAI,WAAA;AAAa,QAAA,WAAA,EAAY;AAC7B,MAAA;AAAA,IAEF,KAAK,GAAA;AAEH,MAAA,OAAA,GAAU,oBAAA;AACV,MAAA,IAAI,UAAA;AAAY,QAAA,UAAA,EAAW;AAC3B,MAAA;AAAA,IAEF,KAAK,GAAA;AAAA,IACL,KAAK,GAAA;AAAA,IACL,KAAK,GAAA;AAAA,IACL,KAAK,GAAA;AAEH,MAAA,OAAA,GAAU,sCAAA;AACV,MAAA,IAAI,aAAA;AAAe,QAAA,aAAA,EAAc;AACjC,MAAA;AAIA;AAGJ,EAAA,IAAI,WAAA;AAAa,IAAA,WAAA,CAAY,SAAS,OAAO,CAAA;AAC7C,EAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,WAAA,EAAc,MAAM,CAAA,CAAA,CAAA,EAAK,SAAS,IAAI,CAAA;AAEpD,EAAA,OAAO,OAAA,CAAQ,OAAO,KAAK,CAAA;AAC7B;AAkCO,SAAS,kBAAkB,YAAA,GAAe,EAAC,EAAG,kBAAA,GAAqB,EAAC,EAAG;AAC5E,EAAA,MAAM;AAAA,IACJ,kBAAA,GAAqB,yBAAA;AAAA,IACrB,mBAAA,GAAsB,0BAAA;AAAA,IACtB,mBAAA,GAAsB,0BAAA;AAAA,IACtB,oBAAA,GAAuB;AAAA,GACzB,GAAI,kBAAA;AAGJ,EAAA,MAAM,MAAA,GAAS;AAAA,IACb,GAAG,YAAA,EAAa;AAAA,IAChB,GAAG;AAAA,GACL;AAGA,EAAA,MAAM,QAAA,GAAW,KAAA,CAAM,MAAA,CAAO,MAAM,CAAA;AAGpC,EAAA,QAAA,CAAS,aAAa,OAAA,CAAQ,GAAA;AAAA,IAC5B,kBAAA;AAAA,IACA;AAAA,GACF;AAGA,EAAA,QAAA,CAAS,aAAa,QAAA,CAAS,GAAA;AAAA,IAC7B,mBAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,OAAO,QAAA;AACT;AAMO,MAAM,MAAM,iBAAA;AAaZ,SAAS,SAAA,CAAU,GAAA,EAAK,MAAA,GAAS,EAAC,EAAG;AAC1C,EAAA,MAAM,WAAA,GAAc,MAAA,CAAO,IAAA,CAAK,MAAM,EACnC,MAAA,CAAO,CAAC,GAAA,KAAQ,MAAA,CAAO,GAAG,CAAA,KAAM,MAAA,IAAa,MAAA,CAAO,GAAG,CAAA,KAAM,IAAI,CAAA,CACjE,GAAA,CAAI,CAAC,GAAA,KAAQ,CAAA,EAAG,kBAAA,CAAmB,GAAG,CAAC,CAAA,CAAA,EAAI,kBAAA,CAAmB,MAAA,CAAO,GAAG,CAAC,CAAC,CAAA,CAAE,CAAA,CAC5E,KAAK,GAAG,CAAA;AAEX,EAAA,OAAO,WAAA,GAAc,CAAA,EAAG,GAAG,CAAA,CAAA,EAAI,WAAW,CAAA,CAAA,GAAK,GAAA;AACjD;AAOO,SAAS,YAAA,CAAa,UAAU,QAAA,EAAU;AAC/C,EAAA,MAAM,GAAA,GAAM,MAAA,CAAO,GAAA,CAAI,eAAA,CAAgB,IAAI,KAAK,CAAC,QAAA,CAAS,IAAI,CAAC,CAAC,CAAA;AAChE,EAAA,MAAM,IAAA,GAAO,QAAA,CAAS,aAAA,CAAc,GAAG,CAAA;AACvC,EAAA,IAAA,CAAK,IAAA,GAAO,GAAA;AACZ,EAAA,IAAA,CAAK,YAAA,CAAa,YAAY,QAAQ,CAAA;AACtC,EAAA,QAAA,CAAS,IAAA,CAAK,YAAY,IAAI,CAAA;AAC9B,EAAA,IAAA,CAAK,KAAA,EAAM;AACX,EAAA,QAAA,CAAS,IAAA,CAAK,YAAY,IAAI,CAAA;AAC9B,EAAA,MAAA,CAAO,GAAA,CAAI,gBAAgB,GAAG,CAAA;AAChC;AAEA,mBAAe;AAAA,EACb,cAAA;AAAA,EACA,WAAA;AAAA,EACA,YAAA;AAAA,EACA,iBAAA;AAAA,EACA,SAAA;AAAA,EACA,YAAA;AAAA,EACA,GAAA;AAAA,EACA,KAAA;AAAA;AAAA,EAEA,yBAAA;AAAA,EACA,0BAAA;AAAA,EACA,0BAAA;AAAA,EACA;AACF,CAAA;;;;"}