{"version":3,"file":"useFormValidation.js","sources":["../../src/hooks/useFormValidation.js"],"sourcesContent":["/**\n * 表单验证 Hook\n * 参考 vue-vben-admin 实现\n */\nimport { ref, unref, nextTick } from 'vue'\n\n/**\n * 使用表单验证\n * @param {Object} formRef 表单ref\n * @returns {Object} 表单验证方法\n */\nexport function useFormValidation(formRef) {\n  const validating = ref(false)\n\n  /**\n   * 验证整个表单\n   */\n  const validate = async () => {\n    const form = unref(formRef)\n    if (!form) {\n      console.warn('Form ref is not ready')\n      return false\n    }\n\n    validating.value = true\n    try {\n      await form.validate()\n      validating.value = false\n      return true\n    } catch (error) {\n      validating.value = false\n      console.error('Form validation failed:', error)\n      return false\n    }\n  }\n\n  /**\n   * 验证指定字段\n   */\n  const validateField = async (fields) => {\n    const form = unref(formRef)\n    if (!form) {\n      console.warn('Form ref is not ready')\n      return false\n    }\n\n    const fieldArray = Array.isArray(fields) ? fields : [fields]\n\n    try {\n      await form.validateFields(fieldArray)\n      return true\n    } catch (error) {\n      console.error('Field validation failed:', error)\n      return false\n    }\n  }\n\n  /**\n   * 重置表单验证状态\n   */\n  const resetValidation = () => {\n    const form = unref(formRef)\n    if (form) {\n      form.clearValidate()\n    }\n  }\n\n  /**\n   * 重置表单（包括值和验证状态）\n   */\n  const resetForm = () => {\n    const form = unref(formRef)\n    if (form) {\n      form.resetFields()\n    }\n  }\n\n  /**\n   * 获取表单值\n   */\n  const getFieldsValue = () => {\n    const form = unref(formRef)\n    if (!form) {\n      return {}\n    }\n    return form.getFieldsValue ? form.getFieldsValue() : {}\n  }\n\n  /**\n   * 设置表单值\n   */\n  const setFieldsValue = (values) => {\n    const form = unref(formRef)\n    if (form && form.setFieldsValue) {\n      form.setFieldsValue(values)\n    }\n  }\n\n  /**\n   * 设置字段错误信息\n   */\n  const setFields = (fields) => {\n    const form = unref(formRef)\n    if (form && form.setFields) {\n      form.setFields(fields)\n    }\n  }\n\n  /**\n   * 滚动到第一个错误字段\n   */\n  const scrollToField = async (field) => {\n    const form = unref(formRef)\n    if (form && form.scrollToField) {\n      await nextTick()\n      form.scrollToField(field)\n    }\n  }\n\n  return {\n    validating,\n    validate,\n    validateField,\n    resetValidation,\n    resetForm,\n    getFieldsValue,\n    setFieldsValue,\n    setFields,\n    scrollToField\n  }\n}\n\n/**\n * 使用表单提交\n * @param {Object} options 配置选项\n * @returns {Object} 表单提交方法和状态\n */\nexport function useFormSubmit(options = {}) {\n  const {\n    formRef,\n    onSubmit,\n    onSuccess,\n    onError,\n    validateFirst = true,\n    showSuccessMessage = true,\n    successMessage = '提交成功',\n    showErrorMessage = true,\n    errorMessage = '提交失败'\n  } = options\n\n  const submitting = ref(false)\n  const { validate } = useFormValidation(formRef)\n\n  /**\n   * 提交表单\n   */\n  const handleSubmit = async () => {\n    // 验证表单\n    if (validateFirst) {\n      const valid = await validate()\n      if (!valid) {\n        return false\n      }\n    }\n\n    submitting.value = true\n\n    try {\n      const form = unref(formRef)\n      const values = form ? (form.getFieldsValue ? form.getFieldsValue() : {}) : {}\n\n      // 执行提交回调\n      if (onSubmit) {\n        await onSubmit(values)\n      }\n\n      // 成功回调\n      if (onSuccess) {\n        onSuccess(values)\n      }\n\n      // 显示成功消息\n      if (showSuccessMessage && window.$message) {\n        window.$message.success(successMessage)\n      }\n\n      submitting.value = false\n      return true\n    } catch (error) {\n      console.error('Form submit error:', error)\n\n      // 错误回调\n      if (onError) {\n        onError(error)\n      }\n\n      // 显示错误消息\n      if (showErrorMessage && window.$message) {\n        window.$message.error(errorMessage)\n      }\n\n      submitting.value = false\n      return false\n    }\n  }\n\n  return {\n    submitting,\n    handleSubmit\n  }\n}\n\n/**\n * 使用表单错误处理\n */\nexport function useFormErrors() {\n  const errors = ref({})\n\n  /**\n   * 设置错误\n   */\n  const setError = (field, message) => {\n    errors.value[field] = message\n  }\n\n  /**\n   * 设置多个错误\n   */\n  const setErrors = (errorObj) => {\n    errors.value = { ...errors.value, ...errorObj }\n  }\n\n  /**\n   * 清除错误\n   */\n  const clearError = (field) => {\n    delete errors.value[field]\n  }\n\n  /**\n   * 清除所有错误\n   */\n  const clearErrors = () => {\n    errors.value = {}\n  }\n\n  /**\n   * 获取错误\n   */\n  const getError = (field) => {\n    return errors.value[field]\n  }\n\n  /**\n   * 是否有错误\n   */\n  const hasError = (field) => {\n    return field ? !!errors.value[field] : Object.keys(errors.value).length > 0\n  }\n\n  return {\n    errors,\n    setError,\n    setErrors,\n    clearError,\n    clearErrors,\n    getError,\n    hasError\n  }\n}\n\n/**\n * 使用字段依赖验证\n * 当某个字段改变时，重新验证依赖它的字段\n */\nexport function useFieldDependencies(formRef) {\n  const { validateField } = useFormValidation(formRef)\n\n  /**\n   * 注册字段依赖关系\n   * @param {Object} dependencies { field: [dependentFields] }\n   */\n  const registerDependencies = (dependencies) => {\n    const form = unref(formRef)\n    if (!form) return\n\n    Object.keys(dependencies).forEach(field => {\n      const dependentFields = dependencies[field]\n\n      // 监听字段变化\n      form.watchField && form.watchField(field, () => {\n        // 重新验证依赖字段\n        dependentFields.forEach(depField => {\n          validateField(depField)\n        })\n      })\n    })\n  }\n\n  return {\n    registerDependencies\n  }\n}\n\nexport default {\n  useFormValidation,\n  useFormSubmit,\n  useFormErrors,\n  useFieldDependencies\n}\n"],"names":[],"mappings":"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"}