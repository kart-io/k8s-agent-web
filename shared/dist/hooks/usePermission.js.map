{"version":3,"file":"usePermission.js","sources":["../../src/hooks/usePermission.js"],"sourcesContent":["import { computed, ref } from 'vue'\n\n/**\n * 权限钩子\n * 用于判断用户是否有某个权限\n *\n * @param {Object} options - 配置选项\n * @param {Array|Function} options.permissions - 权限列表或返回权限列表的函数\n * @param {Object|Function} options.userInfo - 用户信息或返回用户信息的函数\n * @returns {Object} 权限检查方法\n *\n * @example\n * // 在micro-app中使用（从userStore获取）\n * import { useUserStore } from '@/store/user'\n * const userStore = useUserStore()\n * const { hasPermission, hasRole } = usePermission({\n *   permissions: () => userStore.permissions,\n *   userInfo: () => userStore.userInfo\n * })\n *\n * @example\n * // 直接传入数据\n * const { hasPermission } = usePermission({\n *   permissions: ['user:read', 'user:write']\n * })\n */\nexport function usePermission(options = {}) {\n  const { permissions: permissionsInput, userInfo: userInfoInput } = options\n\n  /**\n   * 获取用户权限列表\n   */\n  const permissions = computed(() => {\n    if (typeof permissionsInput === 'function') {\n      return permissionsInput() || []\n    }\n    return permissionsInput || []\n  })\n\n  /**\n   * 获取用户信息\n   */\n  const userInfo = computed(() => {\n    if (typeof userInfoInput === 'function') {\n      return userInfoInput() || {}\n    }\n    return userInfoInput || {}\n  })\n\n  /**\n   * 检查是否有权限\n   * @param {String|Array} permission - 权限码或权限码数组\n   * @param {String} mode - 检查模式：'some'(任一) 或 'every'(全部)\n   * @returns {Boolean}\n   */\n  const hasPermission = (permission, mode = 'some') => {\n    // 超级管理员拥有所有权限\n    if (permissions.value.includes('*')) {\n      return true\n    }\n\n    if (!permission) {\n      return true\n    }\n\n    // 单个权限\n    if (typeof permission === 'string') {\n      return permissions.value.includes(permission)\n    }\n\n    // 多个权限\n    if (Array.isArray(permission)) {\n      if (mode === 'every') {\n        return permission.every(p => permissions.value.includes(p))\n      }\n      return permission.some(p => permissions.value.includes(p))\n    }\n\n    return false\n  }\n\n  /**\n   * 检查是否有角色\n   * @param {String|Array} role - 角色或角色数组\n   * @param {String} mode - 检查模式\n   * @returns {Boolean}\n   */\n  const hasRole = (role, mode = 'some') => {\n    const userRoles = userInfo.value?.roles || []\n\n    if (!role) {\n      return true\n    }\n\n    // 单个角色\n    if (typeof role === 'string') {\n      return userRoles.includes(role)\n    }\n\n    // 多个角色\n    if (Array.isArray(role)) {\n      if (mode === 'every') {\n        return role.every(r => userRoles.includes(r))\n      }\n      return role.some(r => userRoles.includes(r))\n    }\n\n    return false\n  }\n\n  return {\n    permissions,\n    hasPermission,\n    hasRole\n  }\n}\n\n"],"names":[],"mappings":";;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,aAAa,CAAC,OAAO,GAAG,EAAE,EAAE;AAC5C,EAAE,MAAM,EAAE,WAAW,EAAE,gBAAgB,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG;;AAErE;AACA;AACA;AACA,EAAE,MAAM,WAAW,GAAG,QAAQ,CAAC,MAAM;AACrC,IAAI,IAAI,OAAO,gBAAgB,KAAK,UAAU,EAAE;AAChD,MAAM,OAAO,gBAAgB,EAAE,IAAI;AACnC,IAAI;AACJ,IAAI,OAAO,gBAAgB,IAAI;AAC/B,EAAE,CAAC;;AAEH;AACA;AACA;AACA,EAAE,MAAM,QAAQ,GAAG,QAAQ,CAAC,MAAM;AAClC,IAAI,IAAI,OAAO,aAAa,KAAK,UAAU,EAAE;AAC7C,MAAM,OAAO,aAAa,EAAE,IAAI;AAChC,IAAI;AACJ,IAAI,OAAO,aAAa,IAAI;AAC5B,EAAE,CAAC;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,aAAa,GAAG,CAAC,UAAU,EAAE,IAAI,GAAG,MAAM,KAAK;AACvD;AACA,IAAI,IAAI,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;AACzC,MAAM,OAAO;AACb,IAAI;;AAEJ,IAAI,IAAI,CAAC,UAAU,EAAE;AACrB,MAAM,OAAO;AACb,IAAI;;AAEJ;AACA,IAAI,IAAI,OAAO,UAAU,KAAK,QAAQ,EAAE;AACxC,MAAM,OAAO,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,UAAU;AAClD,IAAI;;AAEJ;AACA,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;AACnC,MAAM,IAAI,IAAI,KAAK,OAAO,EAAE;AAC5B,QAAQ,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC,IAAI,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;AAClE,MAAM;AACN,MAAM,OAAO,UAAU,CAAC,IAAI,CAAC,CAAC,IAAI,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;AAC/D,IAAI;;AAEJ,IAAI,OAAO;AACX,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,OAAO,GAAG,CAAC,IAAI,EAAE,IAAI,GAAG,MAAM,KAAK;AAC3C,IAAI,MAAM,SAAS,GAAG,QAAQ,CAAC,KAAK,EAAE,KAAK,IAAI;;AAE/C,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,OAAO;AACb,IAAI;;AAEJ;AACA,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;AAClC,MAAM,OAAO,SAAS,CAAC,QAAQ,CAAC,IAAI;AACpC,IAAI;;AAEJ;AACA,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;AAC7B,MAAM,IAAI,IAAI,KAAK,OAAO,EAAE;AAC5B,QAAQ,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;AACpD,MAAM;AACN,MAAM,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;AACjD,IAAI;;AAEJ,IAAI,OAAO;AACX,EAAE;;AAEF,EAAE,OAAO;AACT,IAAI,WAAW;AACf,IAAI,aAAa;AACjB,IAAI;AACJ;AACA;;;;"}