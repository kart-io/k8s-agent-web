{"version":3,"file":"download.js","sources":["../../src/utils/download.js"],"sourcesContent":["/**\n * 下载工具函数\n */\n\n/**\n * 下载文件\n * @param {Blob|String} data - 文件数据或URL\n * @param {String} filename - 文件名\n * @param {String} mime - MIME类型\n */\nexport function downloadFile(data, filename, mime) {\n  let blob\n\n  if (data instanceof Blob) {\n    blob = data\n  } else if (typeof data === 'string') {\n    // 如果是URL，通过fetch下载\n    if (data.startsWith('http://') || data.startsWith('https://')) {\n      downloadByUrl(data, filename)\n      return\n    }\n\n    // 如果是base64或其他字符串\n    blob = new Blob([data], { type: mime || 'text/plain' })\n  } else {\n    console.error('Invalid data type for download')\n    return\n  }\n\n  // 创建下载链接\n  const url = window.URL.createObjectURL(blob)\n  const link = document.createElement('a')\n  link.href = url\n  link.download = filename || 'download'\n  link.style.display = 'none'\n\n  document.body.appendChild(link)\n  link.click()\n\n  // 清理\n  document.body.removeChild(link)\n  window.URL.revokeObjectURL(url)\n}\n\n/**\n * 通过URL下载文件\n * @param {String} url - 文件URL\n * @param {String} filename - 文件名\n */\nexport function downloadByUrl(url, filename) {\n  const link = document.createElement('a')\n  link.href = url\n  link.download = filename || url.split('/').pop()\n  link.target = '_blank'\n  link.style.display = 'none'\n\n  document.body.appendChild(link)\n  link.click()\n\n  document.body.removeChild(link)\n}\n\n/**\n * 下载Base64文件\n * @param {String} base64 - Base64字符串\n * @param {String} filename - 文件名\n * @param {String} mime - MIME类型\n */\nexport function downloadBase64(base64, filename, mime = 'application/octet-stream') {\n  const byteString = atob(base64.split(',')[1] || base64)\n  const arrayBuffer = new ArrayBuffer(byteString.length)\n  const intArray = new Uint8Array(arrayBuffer)\n\n  for (let i = 0; i < byteString.length; i++) {\n    intArray[i] = byteString.charCodeAt(i)\n  }\n\n  const blob = new Blob([intArray], { type: mime })\n  downloadFile(blob, filename)\n}\n\n/**\n * 下载JSON文件\n * @param {Object} data - JSON数据\n * @param {String} filename - 文件名\n */\nexport function downloadJSON(data, filename = 'data.json') {\n  const json = JSON.stringify(data, null, 2)\n  const blob = new Blob([json], { type: 'application/json' })\n  downloadFile(blob, filename)\n}\n\n/**\n * 下载CSV文件\n * @param {Array} data - 数据数组\n * @param {String} filename - 文件名\n * @param {Array} headers - 表头\n */\nexport function downloadCSV(data, filename = 'data.csv', headers = null) {\n  let csv = ''\n\n  // 添加表头\n  if (headers && headers.length > 0) {\n    csv += headers.join(',') + '\\n'\n  } else if (data.length > 0) {\n    csv += Object.keys(data[0]).join(',') + '\\n'\n  }\n\n  // 添加数据行\n  data.forEach(row => {\n    const values = Object.values(row).map(val => {\n      // 处理包含逗号或引号的值\n      if (typeof val === 'string' && (val.includes(',') || val.includes('\"'))) {\n        return `\"${val.replace(/\"/g, '\"\"')}\"`\n      }\n      return val\n    })\n    csv += values.join(',') + '\\n'\n  })\n\n  // 添加BOM，解决中文乱码\n  const blob = new Blob(['\\ufeff' + csv], { type: 'text/csv;charset=utf-8' })\n  downloadFile(blob, filename)\n}\n\n/**\n * 下载文本文件\n * @param {String} text - 文本内容\n * @param {String} filename - 文件名\n */\nexport function downloadText(text, filename = 'text.txt') {\n  const blob = new Blob([text], { type: 'text/plain;charset=utf-8' })\n  downloadFile(blob, filename)\n}\n\n/**\n * 下载Excel文件（需要配合xlsx库）\n * @param {Array} data - 数据数组\n * @param {String} filename - 文件名\n * @param {String} sheetName - Sheet名称\n */\nexport function downloadExcel(data, filename = 'data.xlsx', sheetName = 'Sheet1') {\n  // 这里需要安装 xlsx 库：pnpm add xlsx\n  // import * as XLSX from 'xlsx'\n\n  console.warn('downloadExcel requires xlsx library. Please install it first: pnpm add xlsx')\n\n  // 示例代码（需要先安装xlsx）:\n  /*\n  const ws = XLSX.utils.json_to_sheet(data)\n  const wb = XLSX.utils.book_new()\n  XLSX.utils.book_append_sheet(wb, ws, sheetName)\n  XLSX.writeFile(wb, filename)\n  */\n}\n"],"names":[],"mappings":"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"}