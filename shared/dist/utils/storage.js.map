{"version":3,"file":"storage.js","sources":["../../src/utils/storage.js"],"sourcesContent":["/**\n * 本地存储工具函数\n * 支持过期时间和命名空间\n */\n\nconst DEFAULT_PREFIX = 'k8s-agent-'\nconst DEFAULT_EXPIRE = 7 * 24 * 60 * 60 * 1000 // 7天\n\n/**\n * 创建存储实例\n * @param {Object} options - 配置选项\n * @returns {Object} 存储实例\n */\nexport function createStorage(options = {}) {\n  const {\n    prefix = DEFAULT_PREFIX,\n    storage = localStorage,\n    expire = DEFAULT_EXPIRE\n  } = options\n\n  /**\n   * 生成完整的key\n   */\n  const getKey = (key) => {\n    return `${prefix}${key}`\n  }\n\n  /**\n   * 设置存储\n   */\n  const set = (key, value, expireTime = expire) => {\n    const fullKey = getKey(key)\n\n    const data = {\n      value,\n      expire: expireTime ? Date.now() + expireTime : null\n    }\n\n    try {\n      storage.setItem(fullKey, JSON.stringify(data))\n      return true\n    } catch (error) {\n      console.error('Storage set error:', error)\n      return false\n    }\n  }\n\n  /**\n   * 获取存储\n   */\n  const get = (key, defaultValue = null) => {\n    const fullKey = getKey(key)\n\n    try {\n      const item = storage.getItem(fullKey)\n\n      if (!item) {\n        return defaultValue\n      }\n\n      const data = JSON.parse(item)\n\n      // 检查是否过期\n      if (data.expire && data.expire < Date.now()) {\n        remove(key)\n        return defaultValue\n      }\n\n      return data.value\n    } catch (error) {\n      console.error('Storage get error:', error)\n      return defaultValue\n    }\n  }\n\n  /**\n   * 移除存储\n   */\n  const remove = (key) => {\n    const fullKey = getKey(key)\n\n    try {\n      storage.removeItem(fullKey)\n      return true\n    } catch (error) {\n      console.error('Storage remove error:', error)\n      return false\n    }\n  }\n\n  /**\n   * 清空所有存储（仅清空带前缀的）\n   */\n  const clear = () => {\n    try {\n      const keys = Object.keys(storage)\n      keys.forEach(key => {\n        if (key.startsWith(prefix)) {\n          storage.removeItem(key)\n        }\n      })\n      return true\n    } catch (error) {\n      console.error('Storage clear error:', error)\n      return false\n    }\n  }\n\n  /**\n   * 获取所有存储的key\n   */\n  const getKeys = () => {\n    try {\n      const keys = Object.keys(storage)\n      return keys\n        .filter(key => key.startsWith(prefix))\n        .map(key => key.replace(prefix, ''))\n    } catch (error) {\n      console.error('Storage getKeys error:', error)\n      return []\n    }\n  }\n\n  /**\n   * 检查key是否存在\n   */\n  const has = (key) => {\n    return get(key) !== null\n  }\n\n  return {\n    set,\n    get,\n    remove,\n    clear,\n    getKeys,\n    has\n  }\n}\n\n// 默认的 localStorage 实例\nexport const storage = createStorage()\n\n// sessionStorage 实例\nexport const sessionStorage = createStorage({\n  storage: window.sessionStorage\n})\n"],"names":[],"mappings":"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"}